<!--
	作者：Sariay
	时间：2018-08-26
	描述：There may be a bug, but don't worry, Qiling(器灵) says that it can work normally! aha!
-->
<!DOCTYPE html>
<html class="html-loading">
		

<head>
	<meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
  <title>
    
      Mybatis知识点 | Sweet Home
    
  </title>
  <meta name="author" content="Sariay">
  <meta name="keywords" content="" />
  <meta name="description" content="" />
	<!-- favicon -->
  <link rel="shortcut icon" href="/img/logo1.ico">

  <!-- css -->
  
<link rel="stylesheet" href="/css/Annie.css">

  
  <!-- jquery -->
	
<script src="/plugin/jquery/jquery.min.js"></script>


<script>
    const CONFIG_BGIMAGE = {
      mode: 'normal',
      normalSrc: '/img/header-bg1.jpg',
      randomYouMax: 110,
      randomYouSrc: 'https://Whiteboy-DY.github.io/Random-img/',
	  randomOtherSrc: 'https://api.berryapi.net/?service=App.Bing.Images&day=-0',
	  preloaderEnable: true
    }
	
    const CONFIG_LEACLOUD_COUNT = {
      enable: false,
	  appId: 'AU8...',
	  appKey: '4cU...',
	  serverURLs: 'http' || ' '
    }
  </script>
<meta name="generator" content="Hexo 5.4.0"></head>
	<body>
		<!-- Preloader -->

	<div id="preloader">
		<div class="pre-container">
			
				<div class="spinner">
					<div class="double-bounce1"></div>
					<div class="double-bounce2"></div>
				</div>
						
		</div>
	</div>


<!-- header -->
<header class="fixbackground bg-pan-br">
	<div class="mask">
		<!-- motto -->
		<div class="h-body">	
			
				<div class="motto text-shadow-pop-left">
					<p class="content" id="motto-content">获取中...</p>
					<p>-<p>
					<p class="author" id="motto-author">Just a minute...</p>
				</div>
			
		</div>
		
		<!-- others: such as time... -->			
		<div class="h-footer">
			<a href="javascript:;" id="read-more" class="scroll-down">
				<span class="icon-anchor1 animation-scroll-down"></span>
			</a>
		</div>
	</div>
</header>

<div id="navigation-hide">
	<!-- Progress bar -->
	<div id="progress-bar"></div>

	<!-- Progress percent -->
	<div id="progress-percentage"><span>0.0%</span></div>

	<div class="toc-switch"><span class="switch-button">目录</span></div>

	<!-- Page title -->
	<p>
		
			「Mybatis知识点」
		
	</p>

	
	

	<!-- Nav trigger for navigation-H-->
	<a class="nav-trigger"><span></span></a>
</div>

<!-- Navigation in div(id="navigation-H") -->
<nav class="nav-container" id="cd-nav">
	<div class="nav-header">
		<span class="logo"> 
			<img src="/img/logo.png">
		</span>
		<a href="javascript:;" class="nav-close"></a>
	</div>
	
	<div class="nav-body">
		<ul id="global-nav">
	
		<li class="menu-home">
			<a href="https://Whiteboy-DY.github.io" class="menu-item-home" target="_blank">主页</a>
		</li>
		
	
		<li class="menu-archive">
			<a href="/archives" class="menu-item-archive" target="_blank">归档</a>
		</li>
		
	
		<li class="menu-categories">
			<a href="/categories" class="menu-item-categories" target="_blank">分类</a>
		</li>
		
	
		<li class="menu-tags">
			<a href="/tags" class="menu-item-tags" target="_blank">标签</a>
		</li>
		
	
		<li class="menu-about">
			<a href="/about" class="menu-item-about" target="_blank">关于</a>
		</li>
		
	

	
		<li class="menu-search">
			<a href="javascript:;" class="popup-trigger">搜索</a>
		</li>
	
</ul>
	</div>
	
	<div class="nav-footer">
		<ul id="global-social">
	
		<li>
			<a href="http://github.com/" target="_blank">
				<span class="icon-github"></span>
			</a>
		</li>
	
		<li>
			<a href="http://github.com/" target="_blank">
				<span class="icon-sina-weibo "></span>
			</a>
		</li>
			
</ul>

	</div>
</nav>
			
		<!--main-->
		<main>
			<!--
	时间：2018-11-17
	描述：
		插件名称：katelog.min.js
		插件作者：KELEN
		插件来源: https://github.com/KELEN/katelog
-->

	
		<div class="layout-toc">
			<div id="layout-toc">
				<div class="k-catelog-list" id="catelog-list" data-title="文章目录"></div>
			</div>
		</div>

		
<script src="/plugin/toc/katelog.min.js"></script>


		
	 

<div class="layout-post">
	<div id="layout-post">
		<div class="article-title">
			
	<a href="/2021/06/24/SpringBoot%E7%9F%A5%E8%AF%86%E7%82%B9/" itemprop="url">
		Mybatis知识点
	</a>

		</div>

		<div class="article-meta">
			<span>
				<i class="icon-calendar1"></i>
				
				




	更新于

	<a href="/2021/06/24/SpringBoot%E7%9F%A5%E8%AF%86%E7%82%B9/" itemprop="url">
		<time datetime="2021-06-24T07:56:44.467Z" itemprop="dateUpdated">
	  		2021-06-24
	  </time>
	</a> 



			</span>
			<span>
				
	<i class="icon-price-tags"></i>
	
		<a href="/tags/%E5%90%8E%E7%AB%AF/" class=" ">
			后端
		</a>
	
		<a href="/tags/Mybatis/" class=" ">
			Mybatis
		</a>
	
		
			</span>
			
			



		</div>

		<div class="article-content" id="article-content">
			<div class="toc">

<!-- toc -->

<ul>
<li><a href="#yi-springboot-shi-shi-me">一、SpringBoot是什么？</a><ul>
<li><a href="#1-gai-nian">1.概念</a></li>
<li><a href="#2-mu-de">2.目的</a></li>
<li><a href="#3-shi-me-shi-wei-fu-wu">3.什么是微服务</a></li>
<li><a href="#4-dan-ti-ying-yong-jia-gou">4.单体应用架构</a></li>
<li><a href="#5-ru-he-gou-jian-wei-fu-wu">5.如何构建微服务</a></li>
</ul>
</li>
<li><a href="#er-springboot-yuan-li">二、SpringBoot原理</a><ul>
<li><a href="#1-pom-xml">1.pom.xml</a></li>
<li><a href="#2-qi-dong-qi">2.启动器</a></li>
<li><a href="#3-zhu-cheng-xu">3.主程序</a></li>
<li><a href="#4-zi-dong-zhuang-pei-zai-li-jie">4.自动装配再理解</a></li>
<li><a href="#5-zi-dong-pei-zhi-lei-zhong-cun-fang-liao-da-liang-de-pei-zhi-mei-you-quan-bu-du-sheng-xiao-de-yuan-yin">5.自动配置类中存放了大量的配置没有全部都生效的原因</a></li>
</ul>
</li>
<li><a href="#san-springboot">三、SpringBoot</a><ul>
<li><a href="#1-yaml-yu-fa">1.yaml语法</a></li>
<li><a href="#2-duo-huan-jing-pei-zhi-he-pei-zhi-wen-jian-wei-zhi">2.多环境配置和配置文件位置</a></li>
</ul>
</li>
<li><a href="#si-springbootweb-kai-fa">四、SpringBootWeb开发</a><ul>
<li><a href="#1-springbootweb-kai-fa-xu-yao-jie-jue-de-wen-ti">1.SpringBootWeb开发需要解决的问题</a></li>
<li><a href="#2-jing-tai-zi-yuan-dao-ru">2.静态资源导入</a></li>
<li><a href="#3-shou-ye-ding-zhi-he-tu-biao-ding-zhi">3.首页定制和图标定制</a></li>
<li><a href="#4-mo-ban-yin-qing-thymeleaf">4.模板引擎Thymeleaf</a></li>
<li><a href="#5-kuo-zhan-springmvc">5.扩展springMVC</a></li>
<li><a href="#6-crud">6.CRUD</a></li>
<li><a href="#7-lan-jie-qi">7.拦截器</a></li>
<li><a href="#8-guo-ji-hua">8.国际化</a></li>
<li><a href="#9-springmvcconfig-pei-zhi">9.SpringMvcConfig配置。</a></li>
<li><a href="#10-cuo-wu-ye-ding-zhi">10.错误页定制。</a></li>
</ul>
</li>
<li><a href="#wu-springboot-ji-cheng-de-ji-zhu-kuang-jia">五、SpringBoot集成的技术框架</a><ul>
<li><a href="#1-druid">1.Druid</a></li>
<li><a href="#2-springsecurity">2.springSecurity</a></li>
<li><a href="#3-shiro">3.shiro</a></li>
<li><a href="#4-swagger">4.swagger</a></li>
<li><a href="#5-redis">5.redis</a></li>
</ul>
</li>
<li><a href="#liu-springboot-zheng-he">六、SpringBoot整合</a><ul>
<li><a href="#1-zheng-he-jdbc">1.整合JDBC</a></li>
<li><a href="#2-zheng-he-druid">2.整合druid</a></li>
<li><a href="#3-zheng-he-mybatis">3.整合mybatis</a></li>
<li><a href="#4-springsecurity-shi-yong">4.springSecurity使用</a></li>
<li><a href="#5-shiro-shi-yong">5.shiro使用</a></li>
<li><a href="#5-zheng-he-swagger">5.整合swagger</a></li>
<li><a href="#4-zheng-he-redis">4.整合redis</a></li>
</ul>
</li>
<li><a href="#qi-springboot-shi-xian-ren-wu">七、springboot实现任务</a><ul>
<li><a href="#1-yi-bu-ren-wu">1.异步任务</a></li>
<li><a href="#2-you-jian-fa-song">2.邮件发送</a></li>
</ul>
</li>
<li><a href="#ba-dubbo-he-zookeeper">八、dubbo和Zookeeper</a><ul>
<li><a href="#1-fen-bu-shi-li-lun">1.分布式理论</a></li>
<li><a href="#2-shi-me-shi-rpc">2.什么是RPC</a></li>
<li><a href="#3-shi-me-shi-dubbo">3.什么是dubbo</a></li>
<li><a href="#4-dubbo">4.dubbo</a></li>
<li><a href="#5-zookeeper">5.zookeeper</a></li>
<li><a href="#6-dubbo-admin">6.dubbo-admin</a></li>
<li><a href="#7-springboot-zheng-he-dubbo-zookeeper">7.springboot整合dubbo+zookeeper</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h2><span id="yi-springboot-shi-shi-me">一、SpringBoot是什么？</span><a href="#yi-springboot-shi-shi-me" class="header-anchor">#</a></h2><h3><span id="1-gai-nian">1.概念</span><a href="#1-gai-nian" class="header-anchor">#</a></h3><ul>
<li>SpringBoot是一个javaweb开发的框架。</li>
<li>对比于其他Javaweb框架，更简化开发，约定大于配置。</li>
</ul>
<h3><span id="2-mu-de">2.目的</span><a href="#2-mu-de" class="header-anchor">#</a></h3><ul>
<li>让大家更容易使用spring，更容易集成各种常用的中间件、开源软件。</li>
<li>SpringBoot基于Spring开发, SpringBoot本身并不提供Spring框架的核心特性以及扩展功能，只是用于快速、敏捷地开发新一代基于Spring框架的应用程序。</li>
<li>SpringBoot不是用来替代spring的解决方案，而是和spring框架紧密结合提升spring开发者体验的工具。</li>
</ul>
<h3><span id="3-shi-me-shi-wei-fu-wu">3.什么是微服务</span><a href="#3-shi-me-shi-wei-fu-wu" class="header-anchor">#</a></h3><ul>
<li>微服务是一种架构风格,它要求我们在开发一个应用的时候,这个应用必须构建成一系列小服务的组合;可以通过http的方式进行互通。</li>
<li>MVC架构，MVVM架构，微服务架构。</li>
<li>微服务架构,就是把每个功能元素独立出来。把独立出来的功能元素的动态组合,需要的功能元素才去拿来组合,需要多一些时可以整合多个功能元素。</li>
<li>所以微服务架构是对功能元素进行复制,而没有对整个应用进行复制。</li>
</ul>
<p>优点：1.节省了调用资源。2.每个功能元素的服务都是一个可替换的、可独立升级的软件代码。</p>
<h3><span id="4-dan-ti-ying-yong-jia-gou">4.单体应用架构</span><a href="#4-dan-ti-ying-yong-jia-gou" class="header-anchor">#</a></h3><ul>
<li>单体应用架构(all in one)是指，我们将一个应用的中的所有应用服务都封装在一个应用中；</li>
<li>无论是ERP、CRM或是其他什么系统看，都把数据库访问，web访问，等等各个功能放到一个war包内。</li>
</ul>
<p>优点：易于开发和测试，方便部署；当需要扩展时，只需要将war复制多份,然后放到多个服务器上,再做个负载均衡就可以了。<br>缺点：修改一个非常小的地方,都需要停掉整个服务,重新打包部署这个应用War包；对于一个大型应用，如何维护，如何分工合作都是问题。</p>
<h3><span id="5-ru-he-gou-jian-wei-fu-wu">5.如何构建微服务</span><a href="#5-ru-he-gou-jian-wei-fu-wu" class="header-anchor">#</a></h3><h2><span id="er-springboot-yuan-li">二、SpringBoot原理</span><a href="#er-springboot-yuan-li" class="header-anchor">#</a></h2><h3><span id="1-pom-xml">1.pom.xml</span><a href="#1-pom-xml" class="header-anchor">#</a></h3><ol>
<li>spring-boot-dependencie：核心依赖在父工程中。大部分依赖的版本都是在父工程中管理着，我们拿过来调用即可，因此我们引用一些依赖时不需要指定版本。并且父工程中已经帮我们配置好资源过滤和一些插件。</li>
</ol>
<h3><span id="2-qi-dong-qi">2.启动器</span><a href="#2-qi-dong-qi" class="header-anchor">#</a></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>启动器其实就是springboot的启动场景，比如spring-boot-starter-web启动器会帮我们自动导入web环境所有依赖。</li>
<li>springboot会将所有的功能场景，都变成一个个启动器。</li>
<li>我们要使用什么功能，只需要找到对应的启动器就可以了即starter</li>
</ol>
<h3><span id="3-zhu-cheng-xu">3.主程序</span><a href="#3-zhu-cheng-xu" class="header-anchor">#</a></h3><h4><span id="3-1-zhu-jie">3.1注解</span><a href="#3-1-zhu-jie" class="header-anchor">#</a></h4><p><a target="_blank" rel="noopener" href="https://github.com/SpringBootApplication">@SpringBootApplication</a></p>
<ol>
<li><p>@SpringBootConfiguration</p>
<p>：springboot的配置。</p>
<ul>
<li><p>@Configuration</p>
<p>：spring配置类。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/Component">@Component</a>：说明他也是spring的一个组件。</li>
</ul>
</li>
</ul>
</li>
<li><p>@EnableAutoConfiguration</p>
<p>：自动导入配置。</p>
<ol>
<li><p>@AutoConfigurationPackage</p>
<p>：自动配置包。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/Import">@Import</a>({Registrar.class})：自动配置包注册。</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/Import">@Import</a>({AutoConfigurationImportSelector.class})：自动配置导入选择器。（自动导包的核心）</p>
</li>
</ol>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/ComponentScan">@ComponentScan</a>()：扫描当前主启动类同级的包。（扫描的包到Registrar.class注册）</p>
</li>
</ol>
<p><strong>自动导包的核心AutoConfigurationImportSelector类：选择了什么东西</strong><br>AutoConfigurationImportSelector类中的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.获得自动配置实体（调用“获取所有候选配置”的方法获取实体）。</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> AutoConfigurationEntry <span class="title">getAutoConfigurationEntry</span><span class="params">(AnnotationMetadata annotationMetadata)</span></span></span><br><span class="line"><span class="function">    <span class="comment">// 2.获取所有候选配置（候选配置是哪些配置）。</span></span></span><br><span class="line"><span class="function">    List&lt;String&gt; <span class="title">getCandidateConfigurations</span><span class="params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span></span>&#123;  </span><br><span class="line">    List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(<span class="keyword">this</span>.getSpringFactoriesLoaderFactoryClass(), <span class="keyword">this</span>.getBeanClassLoader());  </span><br><span class="line">    Assert.notEmpty(configurations, </span><br><span class="line">                    <span class="string">&quot;No auto configuration classes found in META-INF/spring.factories. If you are using a custom packaging, make sure that file is correct.&quot;</span>);  </span><br><span class="line">    <span class="keyword">return</span> configurations;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 3.候选配置是所有标注@EnableAutoConfiguration注解的类下的所有配置。（即获取主启动类下的所有配置）</span></span><br><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; getSpringFactoriesLoaderFactoryClass() &#123;   </span><br><span class="line">    <span class="keyword">return</span> EnableAutoConfiguration.class;   </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 4.获取所有的配置从哪里来，上面第二个方法调用了loadFactoryNames方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">loadFactoryNames</span><span class="params">(Class&lt;?&gt; factoryType, <span class="meta">@Nullable</span> ClassLoader classLoader)</span> </span>&#123;      </span><br><span class="line">    String factoryTypeName = factoryType.getName();        </span><br><span class="line">    <span class="keyword">return</span> (List)loadSpringFactories(classLoader).getOrDefault(factoryTypeName, Collections.emptyList());   </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 5.loadFactoryNames方法调用了loadSpringFactories方法</span></span><br><span class="line"><span class="comment">// 6.loadSpringFactories方法从项目资源和系统资源中获取配置文件</span></span><br><span class="line">classLoader.getResources(<span class="string">&quot;META-INF/spring.factories&quot;</span>) ClassLoader.getSystemResources(<span class="string">&quot;META-INF/spring.factories&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>META-INF/spring.factories：自动配置的核心文件。<br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/04/26/kuangstudy751f6ea6-0a01-4a5c-90aa-f8f417afe4bf.jpg" alt="img"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遍历所有的资源，封装成properties供我们使用</span></span><br><span class="line">Properties properties = PropertiesLoaderUtils.loadProperties(resource);</span><br></pre></td></tr></table></figure>

<p><strong>结论</strong>: springboot所有自动配置都是在启动的时候扫描并加载: 所有的自动配置类都在spring.factories里面，但是不一定生效；要判断条件是否成立：只要导入了对应的start，就有对应的启动器，有了启动器，我们自动装配就会生效，然后自动配置就可以成功。</p>
<p><strong>详细步骤</strong>：</p>
<ol>
<li>springboot在启动的时候,从类路径下/META-INF/spring.factories获取指定的值。</li>
<li>将这些自动配置的类导入容器,自动配置就会生效,帮我进行自动配置。</li>
<li>以前我们需要自动配置的东西,现在springboot帮我们做了。</li>
<li>整合javaEE,解决方案和自动配置的东西都在spring-boot-autoconfigure-2.2.0.RELEASE.jar这个包下。</li>
<li>它会把所有需要导入的组件,以类名的方式返回,这些组件就会被添加到容器中。</li>
<li>容器中也会存在非常多的XXXAutoConfiguration的文件(<a target="_blank" rel="noopener" href="https://github.com/Bean">@Bean</a>),就是这些类给容器中导入了这个场景需要的所有组件并自动配置。<a target="_blank" rel="noopener" href="https://github.com/Configuration">@Configuration</a>（JavaConfig）</li>
<li>有了自动配置类,免去了我们手动编写配置文件的工作。</li>
</ol>
<h4><span id="3-2run-fang-fa">3.2Run方法</span><a href="#3-2run-fang-fa" class="header-anchor">#</a></h4><p>main方法中的run方法启动会开启一个服务。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootWeb01Application</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;   </span><br><span class="line">        <span class="comment">// 该方法返回一个ConfigurableApplicationContext对象       </span></span><br><span class="line">        <span class="comment">// 参数一：应用入口的类， 参数二：命令行参数        </span></span><br><span class="line">        SpringApplication.run(SpringbootWeb01Application.class, args); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4><span id="3-3springapplication-run-fen-xi">3.3SpringApplication.run分析</span><a href="#3-3springapplication-run-fen-xi" class="header-anchor">#</a></h4><p>主要两部分</p>
<ul>
<li>一是SpringApplication的实例化。</li>
<li>二是run方法的执行。</li>
</ul>
<h4><span id="3-4springapplication-lei-zhu-yao-zuo-liao-si-jian-shi-qing">3.4SpringApplication类主要做了四件事情</span><a href="#3-4springapplication-lei-zhu-yao-zuo-liao-si-jian-shi-qing" class="header-anchor">#</a></h4><ul>
<li>判断应用的类型是普通项目还是web项目。（普通项目直接就结束了，web项目可以一直启动）</li>
<li>查找并加载所有可用初始化器，设置到initializers属性中。</li>
<li>查找所有的应用程序监听器，设置到listeners属性中。（获取上下文处理bean）</li>
<li>推断并设置main方法的定义类，找到运行的主类。</li>
</ul>
<h3><span id="4-zi-dong-zhuang-pei-zai-li-jie">4.自动装配再理解</span><a href="#4-zi-dong-zhuang-pei-zai-li-jie" class="header-anchor">#</a></h3><p>springboot配置文件能够配置的东西都有一个固有的规律：<br>他们都有对应的xxxAutoConfiguration配置类，这个配置类都会绑定一个xxxProperties类，xxxProperties类和springboot的配置文件绑定；这样我们就可以在springboot配置文件中自定义配置了。</p>
<h4><span id="4-1-zi-dong-zhuang-pei-yuan-li-zai-li-jie">4.1自动装配原理再理解</span><a href="#4-1-zi-dong-zhuang-pei-yuan-li-zai-li-jie" class="header-anchor">#</a></h4><ol>
<li>springboot启动会加载大量的自动配置类。</li>
<li>我们要看我们需要的功能有没有在springboot默认写好的自动配置类中。</li>
<li>我们看这个自动配置类中配置了哪些组件。（不存在就需要全部手动写，如果存在我们就不需要再手动配置；也可以自定义配置覆盖默认的配置）</li>
<li>给容器中自动配置类添加组件时，会从xxxProperties类中获取相应的属性。我们只需要在springboot配置中指定这些属性就可以了。</li>
</ol>
<ul>
<li>xxxAutoConfiguration：自动配置类（给容器中添加组件）</li>
<li>xxxProperties：封装配置文件中的属性</li>
</ul>
<h3><span id="5-zi-dong-pei-zhi-lei-zhong-cun-fang-liao-da-liang-de-pei-zhi-mei-you-quan-bu-du-sheng-xiao-de-yuan-yin">5.自动配置类中存放了大量的配置没有全部都生效的原因</span><a href="#5-zi-dong-pei-zhi-lei-zhong-cun-fang-liao-da-liang-de-pei-zhi-mei-you-quan-bu-du-sheng-xiao-de-yuan-yin" class="header-anchor">#</a></h3><p>spring的底层注解：根据不同的条件，来判断当前配置或者类是否生效。<a target="_blank" rel="noopener" href="https://github.com/Conditionalxxx">@Conditionalxxx</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/ConditionalOnClass">@ConditionalOnClass</a>({Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class})</li>
<li><a target="_blank" rel="noopener" href="https://github.com/ConditionalOnMissingBean">@ConditionalOnMissingBean</a>({WebMvcConfigurationSupport.class})</li>
<li><a target="_blank" rel="noopener" href="https://github.com/ConditionalOnMissingFilterBean">@ConditionalOnMissingFilterBean</a>({RequestContextFilter.class})</li>
<li><a target="_blank" rel="noopener" href="https://github.com/ConditionalOnProperty">@ConditionalOnProperty</a>(prefix = “spring.mvc.formcontent.filter”,name = {“enabled”},matchIfMissing = true)<br>。。。</li>
</ul>
<h2><span id="san-springboot">三、SpringBoot</span><a href="#san-springboot" class="header-anchor">#</a></h2><h3><span id="1-yaml-yu-fa">1.yaml语法</span><a href="#1-yaml-yu-fa" class="header-anchor">#</a></h3><p>SpringBoot使用一个全局的配置文件，配置文件名是固定的。</p>
<ul>
<li>application.properties（语法结构：key=value）</li>
<li>application.yml（语法结构：key:空格value）</li>
</ul>
<p>全局配置文件的作用：修改SpringBoot自动配置的默认值，它会在底层帮我们自动配置。</p>
<h4><span id="1-1-ji-ben-yu-fa">1.1基本语法</span><a href="#1-1-ji-ben-yu-fa" class="header-anchor">#</a></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 对象student:  name: &#39;zs&#39;  age: 12</span><br><span class="line"># 对象的行内写法student1: &#123;name: &#39;zs&#39;,age: 12&#125;</span><br><span class="line"># 数组pets:  - cat  - dog  - pig</span><br><span class="line"># 数组行内写法pets1: [cat,dog,pig]</span><br></pre></td></tr></table></figure>

<h4><span id="1-2-configurationproperties-bang-ding-application-yml-pei-zhi-de-shu-xing-shu-xing-xu-yao-set-fang-fa-cai-neng-qu-zhi">1.2绑定application.yml配置的属性（属性需要set方法才能取值）</span><a href="#1-2-configurationproperties-bang-ding-application-yml-pei-zhi-de-shu-xing-shu-xing-xu-yao-set-fang-fa-cai-neng-qu-zhi" class="header-anchor">#</a></h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*ConfigurationProperties作用将yml配置文件中配置的每个属性的值,映射到这个组件中;告诉SpringBoot将本类中的所有属性和yml配置文件中相关的配置进行绑定;参数prefix=&quot;person&quot;:将yml配置文件中的person下面的所有属性和本类属性对应。（只有这个组件是容器中的组件,才能使用容器提供的ConfigurationProperties功能） */</span> <span class="comment">// 可以直接拿到复杂类型的值</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> String name;  </span><br><span class="line">    <span class="keyword">private</span> Integer age;  </span><br><span class="line">    <span class="keyword">private</span> Boolean flag;  </span><br><span class="line">    <span class="keyword">private</span> Date birth; </span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; map;   </span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; list;  </span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// application.yml</span></span><br><span class="line">person: </span><br><span class="line">name: zs  </span><br><span class="line">    age: <span class="number">12</span> </span><br><span class="line">        flag: <span class="keyword">false</span> </span><br><span class="line">            birth: <span class="number">2021</span>/<span class="number">04</span>/<span class="number">20</span>  </span><br><span class="line">                map: &#123;k1: v1,k2: v2&#125; </span><br><span class="line">list: [code,music,girl]  </span><br><span class="line">dog:   </span><br><span class="line">name: 旺财   </span><br><span class="line">    age: <span class="number">3</span></span><br><span class="line">&lt;!--spring-boot-configuration-processor依赖可以在yml配置时给出提示--&gt;</span><br><span class="line">        &lt;dependency&gt;    </span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;   </span><br><span class="line">        &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;    </span><br><span class="line">        &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h4><span id="1-3-configuration-he-value-pei-he-qu-zhi-mei-you-set-fang-fa-ye-ke-yi-qu-zhi">1.3和配合取值（没有set方法也可以取值）</span><a href="#1-3-configuration-he-value-pei-he-qu-zhi-mei-you-set-fang-fa-ye-ke-yi-qu-zhi" class="header-anchor">#</a></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 复杂类型不能用@Value直接取值</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123; </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;person222.name&#125;&quot;)</span> </span><br><span class="line">    <span class="keyword">private</span> String name;  </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;person222.age&#125;&quot;)</span> </span><br><span class="line">    <span class="keyword">private</span> Integer age;  </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;person222.flag&#125;&quot;)</span> </span><br><span class="line">    <span class="keyword">private</span> Boolean flag;   </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;person222.birth&#125;&quot;)</span>  </span><br><span class="line">    <span class="keyword">private</span> Date birth;   </span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; map;  </span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; list;  </span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// application.yml</span></span><br><span class="line">person222:  name: zs  age: <span class="number">12</span>  flag: <span class="keyword">false</span>  birth: <span class="number">2021</span>/<span class="number">04</span>/<span class="number">20</span>  map: &#123;k1: v1,k2: v2&#125;  list: [code,music,girl]  dog:    name: 旺财    age: <span class="number">3</span></span><br></pre></td></tr></table></figure>

<h4><span id="1-4-propertysource-du-qu-xxx-properties-pei-zhi-mei-you-set-fang-fa-ye-ke-yi-qu-zhi">1.4读取xxx.properties配置（没有set方法也可以取值）</span><a href="#1-4-propertysource-du-qu-xxx-properties-pei-zhi-mei-you-set-fang-fa-ye-ke-yi-qu-zhi" class="header-anchor">#</a></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@PropertySource(value = &quot;classpath:test.properties&quot;)</span></span><br><span class="line"><span class="comment">//可以这样配置</span></span><br><span class="line"><span class="meta">@PropertySource(&#123;&quot;classpath:test.properties&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;   </span><br><span class="line">    <span class="comment">// SPEL表达式取出配置文件的值   </span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;name&#125;&quot;)</span>  </span><br><span class="line">    <span class="keyword">private</span> String name;   </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;age&#125;&quot;)</span>   </span><br><span class="line">    <span class="keyword">private</span> Integer age; </span><br><span class="line">    <span class="keyword">private</span> Boolean flag;    </span><br><span class="line">    <span class="keyword">private</span> Date birth;    </span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; map;  </span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; list;   </span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// test.propertiesname=zhangsanage=13</span></span><br></pre></td></tr></table></figure>

<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/04/20/kuangstudyaca82b0b-176e-4801-8713-8824f91a9f93.jpg" alt="img"></p>
<h4><span id="1-5-song-san-bang-ding">1.5松散绑定</span><a href="#1-5-song-san-bang-ding" class="header-anchor">#</a></h4><p>yml配置属性的-可以和实体属性的驼峰对应绑定</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;   </span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// application.ymlperson:  first-name: zs</span></span><br></pre></td></tr></table></figure>

<h4><span id="1-6-jsr303-shu-ju-xiao-yan">1.6 JSR303数据校验</span><a href="#1-6-jsr303-shu-ju-xiao-yan" class="header-anchor">#</a></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@Validated</span> </span><br><span class="line">    <span class="comment">//数据校验</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;   </span><br><span class="line">        <span class="meta">@Email(message=&quot;邮箱格式错误&quot;)</span> </span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>HibernateValidator是BeanValidation的参考实现；HibernateValidator 提供了JSR 303规范中所有内置constraint的实现；和附加的constraint<br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/04/20/kuangstudyc742666f-a943-4c38-9f1a-fe935d2c2258.jpg" alt="img"><br>HibernateValidator附加的constraint<br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/04/20/kuangstudy0e364be5-78ef-44d9-b777-fb0d87c95f07.jpg" alt="img"></p>
<h3><span id="2-duo-huan-jing-pei-zhi-he-pei-zhi-wen-jian-wei-zhi">2.多环境配置和配置文件位置</span><a href="#2-duo-huan-jing-pei-zhi-he-pei-zhi-wen-jian-wei-zhi" class="header-anchor">#</a></h3><h4><span id="2-1-pei-zhi-wen-jian-wei-zhi">2.1配置文件位置</span><a href="#2-1-pei-zhi-wen-jian-wei-zhi" class="header-anchor">#</a></h4><p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/04/20/kuangstudy0b11d2e3-a772-4b15-8586-8047006683b6.jpg" alt="img"></p>
<h4><span id="2-2-duo-huan-jing-pei-zhi-qie-huan">2.2多环境配置切换</span><a href="#2-2-duo-huan-jing-pei-zhi-qie-huan" class="header-anchor">#</a></h4><p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/04/20/kuangstudyd0d04dca-ff20-4040-b843-040b297217a8.jpg" alt="img"></p>
<h2><span id="si-springbootweb-kai-fa">四、SpringBootWeb开发</span><a href="#si-springbootweb-kai-fa" class="header-anchor">#</a></h2><h3><span id="1-springbootweb-kai-fa-xu-yao-jie-jue-de-wen-ti">1.SpringBootWeb开发需要解决的问题</span><a href="#1-springbootweb-kai-fa-xu-yao-jie-jue-de-wen-ti" class="header-anchor">#</a></h3><ul>
<li>导入静态资源</li>
<li>首页定制</li>
<li>模板引擎Thymeleaf</li>
<li>装配扩展springMVC</li>
<li>增删改查</li>
<li>拦截器</li>
<li>国际化</li>
<li>SpringMvcConfig配置</li>
<li>错误页定制</li>
</ul>
<h3><span id="2-jing-tai-zi-yuan-dao-ru">2.静态资源导入</span><a href="#2-jing-tai-zi-yuan-dao-ru" class="header-anchor">#</a></h3><ol>
<li>在SpringBoot，可以使用以下方式处理静态资源。<ul>
<li>webjars文件夹下：映射访问localhost:8080/webjars/</li>
<li>public文件夹，static文件夹，resources文件夹下和/**(即classpath:)：映射访问localhost:8080/</li>
</ul>
</li>
<li>文件夹优先级（即访问一个静态文件先查找resources文件夹）：resources&gt;static&gt;public</li>
</ol>
<h3><span id="3-shou-ye-ding-zhi-he-tu-biao-ding-zhi">3.首页定制和图标定制</span><a href="#3-shou-ye-ding-zhi-he-tu-biao-ding-zhi" class="header-anchor">#</a></h3><h4><span id="3-1-shou-ye-ding-zhi">3.1首页定制</span><a href="#3-1-shou-ye-ding-zhi" class="header-anchor">#</a></h4><ol>
<li>首页名称需要是index.html</li>
<li>index.html放在静态资源文件夹下（resources，static，public）</li>
<li>localhost:8080/就可以访问到index.html页面</li>
</ol>
<h4><span id="3-2-lao-ban-ben-springboot-zhi-chi-2-1-7">3.2老版本springboot支持(2.1.7)</span><a href="#3-2-lao-ban-ben-springboot-zhi-chi-2-1-7" class="header-anchor">#</a></h4><ol>
<li>favicom.ico图标放在static文件夹下。</li>
<li>配置关闭默认的图标spring.mvc.favicon.ico.enabled=false</li>
</ol>
<h3><span id="4-mo-ban-yin-qing-thymeleaf">4.模板引擎Thymeleaf</span><a href="#4-mo-ban-yin-qing-thymeleaf" class="header-anchor">#</a></h3><p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/04/20/kuangstudy77b774dc-207c-4dcc-963b-4d5941b816d3.jpg" alt="img"></p>
<h4><span id="4-1thymeleaf-shi-yong-bu-zou">4.1thymeleaf使用步骤</span><a href="#4-1thymeleaf-shi-yong-bu-zou" class="header-anchor">#</a></h4><ol>
<li><p>导入jar包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--thymeleaf，我们都是基于3.x开发；2.x项目会报错--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-spring5<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf.extras<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-java8time<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>ThymeleafProperties默认配置<br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/04/20/kuangstudy25462709-b662-423a-9421-77b442deb01a.jpg" alt="img"></p>
</li>
<li><p>controller跳转<br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/04/20/kuangstudyccef096b-ea5e-474c-8f42-94e4123226d5.jpg" alt="img"></p>
</li>
<li><p>xxx.html放在templates文件夹下</p>
<p>xxx.html页面上使用thymeleaf语法，需要引入头文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">title</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4><span id="4-2thymeleaf-yu-fa">4.2thymeleaf语法</span><a href="#4-2thymeleaf-yu-fa" class="header-anchor">#</a></h4><ol>
<li>html和css的元素都可以被thymeleaf接管。</li>
<li>${}用来取值，</li>
<li>@{}用来表示url。</li>
<li>消息文字的表达式#{} 。</li>
<li>提取公共页面。<ul>
<li>th:fragment=”siderbar”</li>
<li><div th:replace="~{commons/commons::siderbar}"></div></li>
</ul>
</li>
</ol>
<h3><span id="5-kuo-zhan-springmvc">5.扩展springMVC</span><a href="#5-kuo-zhan-springmvc" class="header-anchor">#</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sywl.config;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;<span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ViewControllerRegistry;<span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="comment">// 扩展springMVC：只加上@Configuration注解</span></span><br><span class="line"><span class="comment">// 如果再加上@EnableWebMvc就会全面接管springMVC配置。（默认的配置不生效）</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span> </span><br><span class="line"><span class="comment">// 就是导入了DelegatingWebMvcConfiguration类：作用是获取容器中所有的WebMvcConfig</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;   </span><br><span class="line">    <span class="comment">/**    </span></span><br><span class="line"><span class="comment">    * 视图跳转   </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> registry   </span></span><br><span class="line"><span class="comment">    */</span>    </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;  </span><br><span class="line">        <span class="comment">// 访问/test跳转到test.html页面        </span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/test&quot;</span>).setViewName(<span class="string">&quot;test&quot;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3><span id="6-crud">6.CRUD</span><a href="#6-crud" class="header-anchor">#</a></h3><h3><span id="7-lan-jie-qi">7.拦截器</span><a href="#7-lan-jie-qi" class="header-anchor">#</a></h3><ol>
<li><p>自定义拦截器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sywl.config;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="comment">/*** 自定义拦截器*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginHandlerInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123; </span><br><span class="line">            <span class="comment">// 登录成功之后，应该有用户的session    </span></span><br><span class="line">            Object loginUser = request.getSession().getAttribute(<span class="string">&quot;loginUser&quot;</span>);  </span><br><span class="line">            <span class="keyword">if</span> (loginUser == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 1.没有登录      </span></span><br><span class="line">                <span class="comment">// 2.给出提示信息      </span></span><br><span class="line">                request.setAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;没有权限，请先登录&quot;</span>);   </span><br><span class="line">                <span class="comment">// 3.转发到登录页面         </span></span><br><span class="line">                request.getRequestDispatcher(<span class="string">&quot;index.html&quot;</span>).forward(request, response); </span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;     </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;    </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123; </span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>通过springMVC配置文件注入自定义拦截器并设置拦截所有请求和排除拦截的路径。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sywl.config;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.LocaleResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ViewControllerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123; </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">    * 配置拦截器 </span></span><br><span class="line"><span class="comment">    *  </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> registry  </span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;     </span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> LoginHandlerInterceptor())</span><br><span class="line">            <span class="comment">// 1.添加自定义拦截器     </span></span><br><span class="line">            <span class="comment">// 2.添加拦截所有的的路径和页面       </span></span><br><span class="line">            .addPathPatterns(<span class="string">&quot;/**&quot;</span>)        </span><br><span class="line">            <span class="comment">// 3.排除不需要拦截的路径和页面             </span></span><br><span class="line">            .excludePathPatterns(<span class="string">&quot;/index.html&quot;</span>, <span class="string">&quot;/&quot;</span>, <span class="string">&quot;/user/login&quot;</span>,<span class="string">&quot;/css/**&quot;</span>,<span class="string">&quot;/js/**&quot;</span>,<span class="string">&quot;/img/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3><span id="8-guo-ji-hua">8.国际化</span><a href="#8-guo-ji-hua" class="header-anchor">#</a></h3><ol>
<li><p>创建login.properties,login_zh_CN.properties,login_en_US.properties三个配置文件。<br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/04/21/kuangstudy3f8ead79-f7d1-4152-ad27-bf8949b9f603.png" alt="img"></p>
</li>
<li><p>配置这三个文件。通过ResourceBundle可以同时配置三个文件。<br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/04/21/kuangstudyf1fccece-df84-40b5-af65-67ba50f19752.png" alt="img"></p>
</li>
<li><p>配置好的效果。<br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/04/21/kuangstudya40be794-7519-49a6-96ea-8637ccd692db.png" alt="img"></p>
</li>
<li><p>把配置好的属性通过 th:text=”#{login.username}” 放到对应的位置上。</p>
</li>
<li><p>自定义国际化组件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sywl.config;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.LocaleResolver;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"><span class="comment">/*** 自定义国际化组件*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLocaleResolver</span> <span class="keyword">implements</span> <span class="title">LocaleResolver</span> </span>&#123; </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">    * 解析请求 </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> httpServletRequest </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span>  </span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest httpServletRequest)</span> </span>&#123;  </span><br><span class="line">        <span class="comment">// 1.获取请求中的语言参数。   </span></span><br><span class="line">        String language = httpServletRequest.getParameter(<span class="string">&quot;l&quot;</span>);  </span><br><span class="line">        <span class="comment">// 2.如果没有就使用默认的。   </span></span><br><span class="line">        Locale locale = Locale.getDefault(); </span><br><span class="line">        <span class="comment">// 3.如果请求的链接携带了国际化的参数。   </span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(language))&#123;  </span><br><span class="line">            <span class="comment">// zh_CN     </span></span><br><span class="line">            String[] split = language.split(<span class="string">&quot;_&quot;</span>);    </span><br><span class="line">            <span class="comment">// 国家，地区        </span></span><br><span class="line">            locale = <span class="keyword">new</span> Locale(split[<span class="number">0</span>], split[<span class="number">1</span>]);    </span><br><span class="line">        &#125;     </span><br><span class="line">        <span class="keyword">return</span> locale; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocale</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Locale locale)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>在springMVC配置文件把自定义国际化组件注入到spring容器中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sywl.config;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.LocaleResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ViewControllerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">    * 自定义国际化组件注入到spring容器 </span></span><br><span class="line"><span class="comment">    *  </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">    <span class="meta">@Bean</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyLocaleResolver();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>登录界面切换国际化时带上参数。<br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/04/21/kuangstudy2486c169-8040-4921-89c0-4558aa9a796b.png" alt="img"></p>
</li>
</ol>
<h3><span id="9-springmvcconfig-pei-zhi">9.SpringMvcConfig配置。</span><a href="#9-springmvcconfig-pei-zhi" class="header-anchor">#</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sywl.config;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.LocaleResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ViewControllerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="meta">@Configurationpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123; </span><br><span class="line">    <span class="meta">@Override</span>   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;   </span><br><span class="line">        <span class="comment">// 访问localhost:8080/跳转到index.html        </span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;index&quot;</span>);  </span><br><span class="line">        <span class="comment">// 访问localhost:8080/index.html跳转到index.html     </span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/index.html&quot;</span>).setViewName(<span class="string">&quot;index&quot;</span>);    </span><br><span class="line">        <span class="comment">// 访问localhost:8080/main.html跳转到dashboard.html     </span></span><br><span class="line">        <span class="comment">// &quot;redirect:/main.html&quot;即跳转到dashboard.html       </span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/main.html&quot;</span>).setViewName(<span class="string">&quot;dashboard&quot;</span>);   </span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="comment">/**    </span></span><br><span class="line"><span class="comment">    * 自定义国际化组件注入到spring容器  </span></span><br><span class="line"><span class="comment">    *   </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span>   </span></span><br><span class="line"><span class="comment">    */</span>   </span><br><span class="line">    <span class="meta">@Bean</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span> </span>&#123;      </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyLocaleResolver(); </span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="comment">/**   </span></span><br><span class="line"><span class="comment">    * 配置拦截器  </span></span><br><span class="line"><span class="comment">    *     </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> registry   </span></span><br><span class="line"><span class="comment">    */</span>   </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;  </span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> LoginHandlerInterceptor())</span><br><span class="line">            <span class="comment">// 1.添加自定义拦截器         </span></span><br><span class="line">            <span class="comment">// 2.添加拦截所有的的路径和页面              </span></span><br><span class="line">            .addPathPatterns(<span class="string">&quot;/**&quot;</span>)             </span><br><span class="line">            <span class="comment">// 3.排除不需要拦截的路径和页面           </span></span><br><span class="line">            .excludePathPatterns(<span class="string">&quot;/index.html&quot;</span>, <span class="string">&quot;/&quot;</span>, <span class="string">&quot;/user/login&quot;</span>,<span class="string">&quot;/css/**&quot;</span>,<span class="string">&quot;/js/**&quot;</span>,<span class="string">&quot;/img/**&quot;</span>);   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3><span id="10-cuo-wu-ye-ding-zhi">10.错误页定制。</span><a href="#10-cuo-wu-ye-ding-zhi" class="header-anchor">#</a></h3><ol>
<li>在Resources文件夹下的templates文件夹下创建error文件夹。</li>
<li>定义相应错误页面（400.html,500.html等等），放到error文件夹中，就完成了。<br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/04/21/kuangstudy87f5ba3d-0b00-4653-b25f-50202522a03b.jpg" alt="img"></li>
</ol>
<h2><span id="wu-springboot-ji-cheng-de-ji-zhu-kuang-jia">五、SpringBoot集成的技术框架</span><a href="#wu-springboot-ji-cheng-de-ji-zhu-kuang-jia" class="header-anchor">#</a></h2><h3><span id="1-druid">1.Druid</span><a href="#1-druid" class="header-anchor">#</a></h3><ul>
<li>Druid是阿里巴巴开源平台上一个数据库连接池实现,结合了C3P0、DBCP、PROXOOL等DB连接池的优点，同时加入了日志监控。</li>
<li>Druid可以很好的监控DB连接池连接和SQL的执行情况,天生就是针对监控而生的DB连接池。</li>
<li>SpringBoot2.0以上默认使用Hikari数据源，可以说 Hikari与Diud都是当前JavaWeb上最优秀的数据源。</li>
<li>Druid配置。</li>
</ul>
<h3><span id="2-springsecurity">2.springSecurity</span><a href="#2-springsecurity" class="header-anchor">#</a></h3><p>SpringSecurity是针对Spring项目的安全框架，也是Springboot底层安全模块默认的技术选型；他可以实现强大的web安全控制，对于安全控制，我们仅需要引入spring-boot-starter-security模块,进行少量的配置,即可实现强大的安全管理。</p>
<ul>
<li>WebSecurityConfigurerAdapter类：可以继承这个类自定义security授权策略。</li>
<li>AuthenticationManagerBuilder类：自定义security认证策略。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/EnableWebSecurity">@EnableWebSecurity</a>：开启WebSecurity模式。</li>
<li>认证：authentication</li>
<li>授权：authorization</li>
</ul>
<h3><span id="3-shiro">3.shiro</span><a href="#3-shiro" class="header-anchor">#</a></h3><p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/04/24/kuangstudy7a526de1-d1b1-4ff2-99ed-61582e9b4422.png" alt="img"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取当前的用户对象</span></span><br><span class="line">SubjectSubject currentUser = SecurityUtils.getSubject();</span><br><span class="line"><span class="comment">// 通过当前用户获取shiro的session</span></span><br><span class="line">Session session = currentUser.getSession();</span><br><span class="line"><span class="comment">// 判断当前用户是否被认证</span></span><br><span class="line">currentUser.isAuthenticated()</span><br><span class="line">    <span class="comment">// 获得当前用户的认证</span></span><br><span class="line">    currentUser.getPrincipal()</span><br><span class="line">    <span class="comment">// 判断当前用户是否拥某些角色</span></span><br><span class="line">    currentUser.hasRole(<span class="string">&quot;schwartz&quot;</span>)</span><br><span class="line">    <span class="comment">// 判断当前用户是否拥某些权限（参数不同，产生不同效果）</span></span><br><span class="line">	currentUser.isPermitted(<span class="string">&quot;lightsaber:wield&quot;</span>)</span><br><span class="line">    currentUser.isPermitted(<span class="string">&quot;winnebago:drive:eagle5&quot;</span>)</span><br><span class="line">    <span class="comment">// 注销</span></span><br><span class="line">    currentUser.logout();</span><br></pre></td></tr></table></figure>

<h3><span id="4-swagger">4.swagger</span><a href="#4-swagger" class="header-anchor">#</a></h3><ul>
<li>swagger是最流行的api框架。</li>
<li>restful api文档在线自动生成（api文档和api定义同步更新）。</li>
<li>可以直接运行在线测试api接口。</li>
<li>支持多种语言（Java，php）。</li>
<li>通过swagger接口给一些难理解的属性、接口增加注释。</li>
</ul>
<h3><span id="5-redis">5.redis</span><a href="#5-redis" class="header-anchor">#</a></h3><p>在springboot2.x之后，原来使用的jedis被替换为lettuce</p>
<ul>
<li>jedis：底层采用直线服务，多线程使用不安全。如果避免不安全，需要使用jedis Pool连接池。更像BIO模式。</li>
<li>lettuce：底层采用netty，实例可以在多个线程中进行共享,不存在线程不安全的情况，可以减少线程数量了。更像NIO模式。</li>
</ul>
<h2><span id="liu-springboot-zheng-he">六、SpringBoot整合</span><a href="#liu-springboot-zheng-he" class="header-anchor">#</a></h2><h3><span id="1-zheng-he-jdbc">1.整合JDBC</span><a href="#1-zheng-he-jdbc" class="header-anchor">#</a></h3><ol>
<li><p>导入spring-jdbc和mysql驱动的依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--JDBC--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>配置好数据库连接。</p>
</li>
<li><p>springboot已经配置好了jdbc模板可以直接使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCController</span> </span>&#123; </span><br><span class="line">    <span class="meta">@Autowired</span> </span><br><span class="line">    JdbcTemplate jdbcTemplate;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; selectDeptList() &#123;  </span><br><span class="line">        String sql = <span class="string">&quot;select * from depart&quot;</span>; </span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; maps = jdbcTemplate.queryForList(sql); </span><br><span class="line">        System.out.println(maps);   </span><br><span class="line">        <span class="keyword">return</span> maps;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/add&quot;)</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> </span>&#123;    </span><br><span class="line">        String sql = <span class="string">&quot;insert into depart values (6,&#x27;部门6&#x27;)&quot;</span>;  </span><br><span class="line">        <span class="keyword">int</span> update = jdbcTemplate.update(sql);  </span><br><span class="line">        System.out.println(update);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/delete/&#123;id&#125;&quot;)</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123; </span><br><span class="line">        String sql = <span class="string">&quot;delete from depart where id = ?&quot;</span>;   </span><br><span class="line">        <span class="keyword">int</span> update = jdbcTemplate.update(sql,id);   </span><br><span class="line">        System.out.println(update);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/update/&#123;id&#125;&quot;)</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;   </span><br><span class="line">        String sql = <span class="string">&quot;update depart set id = ?,dept_name = ? where id = &quot;</span>+id;  </span><br><span class="line">        Object[] params = <span class="keyword">new</span> Object[<span class="number">2</span>];   </span><br><span class="line">        params[<span class="number">0</span>] = <span class="number">100</span>;  </span><br><span class="line">        params[<span class="number">1</span>] = <span class="string">&quot;部门100&quot;</span>;     </span><br><span class="line">        <span class="keyword">int</span> update = jdbcTemplate.update(sql,params);   </span><br><span class="line">        System.out.println(update);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3><span id="2-zheng-he-druid">2.整合druid</span><a href="#2-zheng-he-druid" class="header-anchor">#</a></h3><ol>
<li><p>导入druid和mysql驱动的依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--druid--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.配置好数据库连接和druid配置。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring</span>:<span class="string"></span></span><br><span class="line"><span class="attr">datasource</span>: <span class="string"></span></span><br><span class="line"><span class="meta">driver-class-name</span>: <span class="string">com.mysql.jdbc.Driver </span></span><br><span class="line"><span class="attr">url</span>: <span class="string">jdbc:mysql://localhost:3306/z-springboot?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone= </span></span><br><span class="line"><span class="attr">username</span>: <span class="string">root </span></span><br><span class="line"><span class="attr">password</span>: <span class="string">xxx </span></span><br><span class="line"><span class="attr">type</span>: <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="comment"># druid数据源配置</span></span><br><span class="line"><span class="attr">initialSize</span>: <span class="string">5 </span></span><br><span class="line"><span class="attr">minIdle</span>: <span class="string">5 </span></span><br><span class="line"><span class="attr">maxActive</span>: <span class="string">20 </span></span><br><span class="line"><span class="attr">maxWait</span>: <span class="string">60000 </span></span><br><span class="line"><span class="attr">timeBetweenEvictionRunsMillis</span>: <span class="string">60000 </span></span><br><span class="line"><span class="attr">minEvictableIdleTimeMillis</span>: <span class="string">300000 </span></span><br><span class="line"><span class="attr">validationQuery</span>: <span class="string">SELECT 1 FROM DUAL </span></span><br><span class="line"><span class="attr">testWhileIdle</span>: <span class="string">true </span></span><br><span class="line"><span class="attr">testOnBorrow</span>: <span class="string">false </span></span><br><span class="line"><span class="attr">testOnReturn</span>: <span class="string">false</span></span><br><span class="line"><span class="attr">poolPreparedStatements</span>: <span class="string">true</span></span><br><span class="line"><span class="comment"># 配置监控统计拦截的filters：stat(监控统计)，log4j(日志记录)，wall(防御sql注入)</span></span><br><span class="line"><span class="comment"># 如果允许时报错java.lang.ClassNotFoundException:org.apache.log4j.Priority则需要导入log4j依赖 </span></span><br><span class="line"><span class="attr">filters</span>: <span class="string">stat,wall,log4j </span></span><br><span class="line"><span class="attr">maxPoolPreparedStatementPerConnectionSize</span>: <span class="string">20 </span></span><br><span class="line"><span class="attr">useGlobalDataSourceStat</span>: <span class="string">true </span></span><br><span class="line"><span class="attr">connectionProperties</span>: <span class="string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span></span><br></pre></td></tr></table></figure>

<p>3.配置DruidConfig类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.support.http.StatViewServlet;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.support.http.WebStatFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.FilterRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.ServletRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;<span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">    * 关联application.yml的druid配置 </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span>  </span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="meta">@Bean</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">druidDataSource</span><span class="params">()</span></span>&#123;   </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// 后台监控：web.xml，ServletRegistrationBean </span></span><br><span class="line">    <span class="comment">// 因为springboot内置了Servlet容器，所以没有web.xml；替代方法：ServletRegistrationBean </span></span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">    * druid后台监控配置  </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">a</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="comment">// 1.配置访问路径localhost:8080/druid  </span></span><br><span class="line">        ServletRegistrationBean&lt;StatViewServlet&gt; bean = <span class="keyword">new</span> ServletRegistrationBean&lt;&gt;(<span class="keyword">new</span> StatViewServlet(),<span class="string">&quot;/druid/*&quot;</span>);  </span><br><span class="line">        <span class="comment">// 2.后台需要有人登录，账号密码配置   </span></span><br><span class="line">        HashMap&lt;String, String&gt; initParameters = <span class="keyword">new</span> HashMap&lt;&gt;();   </span><br><span class="line">        initParameters.put(<span class="string">&quot;loginUsername&quot;</span>,<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">        <span class="comment">// 登录的key是固定的：必须是loginUsername,loginPassword    </span></span><br><span class="line">        initParameters.put(<span class="string">&quot;loginPassword&quot;</span>,<span class="string">&quot;xxx&quot;</span>);    </span><br><span class="line">        <span class="comment">// 3.配置允许谁可以访问：&quot;&quot;意思是谁都可以访问   </span></span><br><span class="line">        initParameters.put(<span class="string">&quot;allow&quot;</span>,<span class="string">&quot;&quot;</span>);     </span><br><span class="line">        <span class="comment">// 4.禁止谁能访问   </span></span><br><span class="line">        initParameters.put(<span class="string">&quot;sywl&quot;</span>,<span class="string">&quot;localhost&quot;</span>);  </span><br><span class="line">        <span class="comment">// 设置初始化参数  </span></span><br><span class="line">        bean.setInitParameters(initParameters);   </span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">    * druid过滤器  </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Bean</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">webStatFilter</span><span class="params">()</span></span>&#123;   </span><br><span class="line">        FilterRegistrationBean&lt;Filter&gt; bean = <span class="keyword">new</span> FilterRegistrationBean&lt;&gt;();</span><br><span class="line">        bean.setFilter(<span class="keyword">new</span> WebStatFilter());     </span><br><span class="line">        HashMap&lt;String, String&gt; initParameters = <span class="keyword">new</span> HashMap&lt;&gt;();   </span><br><span class="line">        <span class="comment">// 可以过滤哪些请求（这些东西不进行统计）   </span></span><br><span class="line">        initParameters.put(<span class="string">&quot;exclusions&quot;</span>,<span class="string">&quot;*.js,*.css,/druid/*&quot;</span>);     </span><br><span class="line">        bean.setInitParameters(initParameters);    </span><br><span class="line">        <span class="keyword">return</span> bean; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3><span id="3-zheng-he-mybatis">3.整合mybatis</span><a href="#3-zheng-he-mybatis" class="header-anchor">#</a></h3><ol>
<li><p>导入springboot整合mybatis的依赖和mysql驱动包的依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--主要用来整合mybatis和spring boot，不是spring官方提供的--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--spring-boot-starter开头的是spring官方的。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>配置好数据库连接和mybatis配置。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">//</span> <span class="string">application.properties</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">8888</span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driverspring.datasource.url=jdbc:mysql://localhost:3306/z-springboot?useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">rootspring.datasource.password=xxx</span></span><br><span class="line"><span class="comment"># mybatis</span></span><br><span class="line"><span class="meta">mybatis.type-aliases-package</span>=<span class="string">com.sywl.entitymybatis.mapper-locations=classpath:mybatis/mapper/*.xml</span></span><br><span class="line"><span class="comment"># classpath:mybatis/mapper/*.xml是从resources文件夹下开始扫描。</span></span><br><span class="line"><span class="comment"># classpath:/mybatis/mapper/*.xml是从项目的根目录开始扫描。</span></span><br></pre></td></tr></table></figure></li>
<li><p>UserMapper接口和UserMapper.xml</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="comment">// 这个注解表示这是mybatis的一个mapper类</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">selectUserList</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">User <span class="title">selectUserById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span>Integer id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insertUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span>Integer id)</span></span>; </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3><span id="4-springsecurity-shi-yong">4.springSecurity使用</span><a href="#4-springsecurity-shi-yong" class="header-anchor">#</a></h3><ol>
<li><p>导入springSecurity依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>配置SecurityConfig类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123; </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">    * 授权 </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> http </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> Exception </span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        <span class="comment">// 首页所有人可以访问，功能页只有对应有权限的人可以访问。   </span></span><br><span class="line">        <span class="comment">// 1.请求权限的规则   </span></span><br><span class="line">        http.authorizeRequests()      </span><br><span class="line">            .mvcMatchers().permitAll()   </span><br><span class="line">            .mvcMatchers(<span class="string">&quot;/level1/**&quot;</span>).hasRole(<span class="string">&quot;vip1&quot;</span>)     </span><br><span class="line">            .mvcMatchers(<span class="string">&quot;/level2/**&quot;</span>).hasRole(<span class="string">&quot;vip2&quot;</span>)      </span><br><span class="line">            .mvcMatchers(<span class="string">&quot;/level3/**&quot;</span>).hasRole(<span class="string">&quot;vip3&quot;</span>);  </span><br><span class="line">        <span class="comment">// 2.开启登录页面（security自带的登录页）（没有权限默认跳转到登录页面）   </span></span><br><span class="line">        http.formLogin().loginPage(<span class="string">&quot;/toLogin&quot;</span>)</span><br><span class="line">            <span class="comment">// 定制登录页：localhost:8080会访问RouterController的/toLogin    </span></span><br><span class="line">            .loginProcessingUrl(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">            <span class="comment">// 设置表单提交的地址。（默认就是/login，但是定制登录页后变成/toLogin）   </span></span><br><span class="line">            .usernameParameter(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">            <span class="comment">// 设置表单提交的用户名的name，默认是username        </span></span><br><span class="line">            .passwordParameter(<span class="string">&quot;pwd&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置表单提交的密码的name，默认是password </span></span><br><span class="line">        <span class="comment">// 3.开启注销功能（logoutSuccessUrl设置登出成功跳转的页面，一般跳转到首页） </span></span><br><span class="line">        <span class="comment">// logoutUrl(&quot;/logout&quot;)是设置登出访问的请求地址。（默认是logout）  </span></span><br><span class="line">        <span class="comment">// 防止网站传输：登出是get的请求     </span></span><br><span class="line">        http.csrf().disable();</span><br><span class="line">        <span class="comment">// 关闭csrf功能(默认是开启的)：登出失败可能的原因就是没有关闭csrf     </span></span><br><span class="line">        http.logout().logoutSuccessUrl(<span class="string">&quot;/&quot;</span>).logoutUrl(<span class="string">&quot;/logout&quot;</span>);   </span><br><span class="line">        <span class="comment">// 4.开启记住我功能：cookies 默认保存两周；自定义&quot;记住我&quot;的name     </span></span><br><span class="line">        http.rememberMe().rememberMeParameter(<span class="string">&quot;remember&quot;</span>); &#125; </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">    * 认证：springboot2.1.x可以直接使用 </span></span><br><span class="line"><span class="comment">    * passwordEncoder：密码编码 </span></span><br><span class="line"><span class="comment">    * springSecurity 5.0+新增了需要加密算法 </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> auth  </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> Exception </span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123; </span><br><span class="line">        <span class="comment">/*User.UserBuilder user = User.withDefaultPasswordEncoder();    </span></span><br><span class="line"><span class="comment">        auth.jdbcAuthentication()        </span></span><br><span class="line"><span class="comment">        .dataSource(datasource)         </span></span><br><span class="line"><span class="comment">        .withDefaultSchema()                   							 </span></span><br><span class="line"><span class="comment">        .withUser(user.username(&quot;user&quot;))</span></span><br><span class="line"><span class="comment">        .password(user.password(&quot;password&quot;))</span></span><br><span class="line"><span class="comment">        .roles(&quot;ADMIN&quot;);</span></span><br><span class="line"><span class="comment">        */</span>     </span><br><span class="line">        <span class="comment">// 这些数据正常从数据库中取    </span></span><br><span class="line">        auth.inMemoryAuthentication().passwordEncoder(<span class="keyword">new</span> BCryptPasswordEncoder())   </span><br><span class="line">            .withUser(<span class="string">&quot;sywl&quot;</span>).password(<span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123456&quot;</span>))</span><br><span class="line">            .roles(<span class="string">&quot;vip2&quot;</span>,<span class="string">&quot;vip3&quot;</span>)             </span><br><span class="line">            .and()           </span><br><span class="line">            .withUser(<span class="string">&quot;root&quot;</span>)</span><br><span class="line">            .password(<span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123456&quot;</span>))</span><br><span class="line">            .roles(<span class="string">&quot;vip1&quot;</span>,<span class="string">&quot;vip2&quot;</span>,<span class="string">&quot;vip3&quot;</span>)     </span><br><span class="line">            .and()            </span><br><span class="line">            .withUser(<span class="string">&quot;guest&quot;</span>)</span><br><span class="line">            .password(<span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123456&quot;</span>))</span><br><span class="line">            .roles(<span class="string">&quot;vip1&quot;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>扩展整合thymeleaf。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--thymeleaf整合security--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf.extras<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-springsecurity4<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>html页面使用sec:xxx 语法。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;nav&quot;</span> <span class="attr">th:fragment</span>=<span class="string">&quot;nav-menu&quot;</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!--sec的密令：springboot最高只在2.0.9版本可以生效--&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;!isAuthenticated()&quot;</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/toLogin&#125;&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;isAuthenticated()&quot;</span>&gt;</span>   </span><br><span class="line">        用户名：<span class="tag">&lt;<span class="name">span</span> <span class="attr">sec:authentication</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/logout&#125;&quot;</span>&gt;</span>注销<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3><span id="5-shiro-shi-yong">5.shiro使用</span><a href="#5-shiro-shi-yong" class="header-anchor">#</a></h3><ol>
<li><p>导入shiro依赖和shiro整合thymeleaf的依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- shiro整合spring的依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--themeleaf整合shiro--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.theborakompanioni<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-shiro<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>自定义UserReam类继承AuthorizingRealm类重写两个方法。用于认证和授权</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123; </span><br><span class="line">    <span class="meta">@Autowired</span> UserMapper userMapper;</span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">    * 授权 </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> principalCollection  </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> </span>&#123;    </span><br><span class="line">        System.out.println(<span class="string">&quot;执行了授权&quot;</span>);    </span><br><span class="line">        SimpleAuthorizationInfo info = <span class="keyword">new</span> SimpleAuthorizationInfo();   </span><br><span class="line">        <span class="comment">// 拿到当前登录对象：subject.getPrincipal()可以获得认证时SimpleAuthenticationInfo传递的user     </span></span><br><span class="line">        Subject subject = SecurityUtils.getSubject();   </span><br><span class="line">        User currentUser = (User) subject.getPrincipal();     </span><br><span class="line">        info.addStringPermission(currentUser.getPerms());     </span><br><span class="line">        <span class="keyword">return</span> info; &#125; </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">    * 认证 </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> authenticationToken  </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> AuthenticationException </span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken authenticationToken)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;   </span><br><span class="line">        System.out.println(<span class="string">&quot;执行了认证&quot;</span>); </span><br><span class="line">        <span class="comment">// 1.拿到用户输入的用户名和密码    </span></span><br><span class="line">        UsernamePasswordToken userToken = (UsernamePasswordToken) authenticationToken;     </span><br><span class="line">        <span class="comment">// 2.连接真实数据库   </span></span><br><span class="line">        User user = userMapper.selectUser(userToken.getUsername());   </span><br><span class="line">        <span class="keyword">if</span> (user==<span class="keyword">null</span>)&#123;       </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;    </span><br><span class="line">        &#125;     </span><br><span class="line">        Session session = SecurityUtils.getSubject().getSession();  </span><br><span class="line">        session.setAttribute(<span class="string">&quot;loginUser&quot;</span>,user);   </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(user,user.getPassword(),<span class="string">&quot;&quot;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>ShiroConfig配置类，配置Ream，SecurityManager，ShiroFilterFactoryBean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShiroConfig</span> </span>&#123; </span><br><span class="line">    <span class="meta">@Bean</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title">shiroFilterFactoryBean</span><span class="params">(<span class="meta">@Qualifier(&quot;securityManager&quot;)</span> DefaultWebSecurityManager securityManager)</span> </span>&#123; </span><br><span class="line">        ShiroFilterFactoryBean bean = <span class="keyword">new</span> ShiroFilterFactoryBean(); </span><br><span class="line">        bean.setSecurityManager(securityManager);  </span><br><span class="line">        <span class="comment">/**      </span></span><br><span class="line"><span class="comment">        * anon:无需认证就可以访问  </span></span><br><span class="line"><span class="comment">        * authc:必须认证了才能访问   </span></span><br><span class="line"><span class="comment">        * user:必须加有&quot;记住我&quot;功能才能用   </span></span><br><span class="line"><span class="comment">        * perms:拥有对某个资源的权限才能访问    </span></span><br><span class="line"><span class="comment">        * roLe:拥有某个角色权限才能访问    </span></span><br><span class="line"><span class="comment">        */</span>    </span><br><span class="line">        LinkedHashMap&lt;String, String&gt; filterMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();    </span><br><span class="line">        filterMap.put(<span class="string">&quot;/user/add&quot;</span>, <span class="string">&quot;perms[user:add]&quot;</span>);     </span><br><span class="line">        filterMap.put(<span class="string">&quot;/user/update&quot;</span>, <span class="string">&quot;perms[user:update]&quot;</span>);    </span><br><span class="line">        filterMap.put(<span class="string">&quot;/user/*&quot;</span>, <span class="string">&quot;authc&quot;</span>);</span><br><span class="line">        <span class="comment">// authc配置需要在perms下面   </span></span><br><span class="line">        bean.setFilterChainDefinitionMap(filterMap);  </span><br><span class="line">        <span class="comment">// 登录失败设置跳转到登录的请求    </span></span><br><span class="line">        bean.setLoginUrl(<span class="string">&quot;/toLogin&quot;</span>);   </span><br><span class="line">        <span class="comment">// 未授权跳转页面    </span></span><br><span class="line">        bean.setUnauthorizedUrl(<span class="string">&quot;/unauth&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> bean; &#125; </span><br><span class="line">    <span class="meta">@Bean(name = &quot;securityManager&quot;)</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultWebSecurityManager <span class="title">securityManager</span><span class="params">(UserRealm userRealm)</span> </span>&#123; </span><br><span class="line">        DefaultWebSecurityManager securityManager = <span class="keyword">new</span> DefaultWebSecurityManager(); </span><br><span class="line">        securityManager.setRealm(userRealm);   </span><br><span class="line">        <span class="keyword">return</span> securityManager;</span><br><span class="line">    &#125; <span class="meta">@Bean</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserRealm <span class="title">userRealm</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserRealm(); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">    * 整合shiroDialect：用来整合shiro thymeleaf </span></span><br><span class="line"><span class="comment">    *（需要导入shiro整合thymeleaf的依赖） </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroDialect <span class="title">shiroDialect</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ShiroDialect();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>登录方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(String username, String password, Model model)</span></span>&#123; </span><br><span class="line">    Subject subject = SecurityUtils.getSubject(); </span><br><span class="line">    UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(username,password);    </span><br><span class="line">    <span class="keyword">try</span> &#123;         </span><br><span class="line">        subject.login(token);    </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;   </span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnknownAccountException e) &#123;     </span><br><span class="line">        model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;用户名不存在&quot;</span>);   </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;     </span><br><span class="line">    &#125;<span class="keyword">catch</span> (IncorrectCredentialsException e)&#123;    </span><br><span class="line">        model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;密码错误&quot;</span>);   </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;   </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>html使用shrio:xxx 语法需要导入头文件。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>   <span class="attr">xmlns:shiro</span>=<span class="string">&quot;http://www.thymeleaf.org/thymeleaf-extras-shiro&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.loginUser!=null&#125;&quot;</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/logout&#125;&quot;</span>&gt;</span>注销<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.loginUser==null&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/toLogin&#125;&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">shiro:hasPermission</span>=<span class="string">&quot;user:add&quot;</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/user/add&#125;&quot;</span>&gt;</span>add<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">shiro:hasPermission</span>=<span class="string">&quot;user:update&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/user/update&#125;&quot;</span>&gt;</span>update<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3><span id="5-zheng-he-swagger">5.整合swagger</span><a href="#5-zheng-he-swagger" class="header-anchor">#</a></h3><ol>
<li><p>导入依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--https://mvnrepository.com/artifact/io.springfox/springfox-swagger2 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--https://mvnrepository.com/artifact/io.springfox/springfox-swagger-ui --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>配置类SwaggerConfig。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span><span class="meta">@EnableSwagger2</span> <span class="comment">// 开启swagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>测试访问：<a target="_blank" rel="noopener" href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a><br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/04/24/kuangstudyea98f14a-6602-41e8-9a88-cef3ab6c7ed7.jpg" alt="img"></p>
</li>
<li><p>自定义swagger相关配置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span> </span><br><span class="line"><span class="comment">// 开启swagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> </span>&#123; </span><br><span class="line">    <span class="comment">// 注册多个Docket实例可以实现分组 </span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">docket</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)       </span><br><span class="line">            .apiInfo(info())        </span><br><span class="line">            .groupName(<span class="string">&quot;sywl&quot;</span>)</span><br><span class="line">            <span class="comment">// 组名       </span></span><br><span class="line">            .enable(<span class="keyword">true</span>)</span><br><span class="line">            <span class="comment">// 是否开启访问swagger；默认true    </span></span><br><span class="line">            .select()        </span><br><span class="line">            <span class="comment">// 配置需要扫描接口的方式RequestHandlerSelectors     </span></span><br><span class="line">            <span class="comment">// basePackage：指定要扫描的包      </span></span><br><span class="line">            <span class="comment">// any()：扫描全部        </span></span><br><span class="line">            <span class="comment">// none()：不扫描     </span></span><br><span class="line">            <span class="comment">// withClassAnnotation()：扫描类上的注解；参数是注解的反射对象  </span></span><br><span class="line">            <span class="comment">// withMethodAnnotation()：扫描方法上的注解   </span></span><br><span class="line">            .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.sywl.controller&quot;</span>))  </span><br><span class="line">            <span class="comment">// paths：过滤路径（只扫描这些请求下的接口）  </span></span><br><span class="line">            .paths(PathSelectors.ant(<span class="string">&quot;/user/**&quot;</span>))          </span><br><span class="line">            .build(); &#125;</span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">    * 配置swagger信息</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApiInfo <span class="title">info</span><span class="params">()</span></span>&#123;   </span><br><span class="line">        <span class="comment">// 作者信息    </span></span><br><span class="line">        Contact contact = <span class="keyword">new</span> Contact(<span class="string">&quot;sywl&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;xxx@163.com&quot;</span>); </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfo(<span class="string">&quot;SwaggerApi文档&quot;</span>,    </span><br><span class="line">                           <span class="string">&quot;这是一个文档描述&quot;</span>,       </span><br><span class="line">                           <span class="string">&quot;1.0&quot;</span>,         </span><br><span class="line">                           <span class="string">&quot;http://www.xxx.com&quot;</span>,       </span><br><span class="line">                           contact,            </span><br><span class="line">                           <span class="string">&quot;Apache 2.0&quot;</span>,   </span><br><span class="line">                           <span class="string">&quot;http://www.apache.org/licenses/LICENSE-2.0&quot;</span>,     </span><br><span class="line">                           <span class="keyword">new</span> ArrayList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>常用标识注解</p>
</li>
</ol>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/ApiModel">@ApiModel</a>(“用户实体类”)：用在实体类上，对类的说明。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/ApiModelProperty">@ApiModelProperty</a>(“用户名”)：用在实体类的属性字段上，对字段的说明。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/ApiOperation">@ApiOperation</a>(“跳转首页的接口”)：用在方法上，对方法的说明。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/ApiParam">@ApiParam</a>(“用户名”)：用在请求参数上，对请求参数的说明。</li>
</ul>
<h3><span id="4-zheng-he-redis">4.整合redis</span><a href="#4-zheng-he-redis" class="header-anchor">#</a></h3><ol>
<li><p>导入依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>配置redis连接。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">//</span> <span class="string">application.yml</span></span><br><span class="line"><span class="attr">spring</span>:     <span class="string"></span></span><br><span class="line">	<span class="attr">redis</span>:     <span class="string"></span></span><br><span class="line">		<span class="attr">host</span>: <span class="string">127.0.0.1     </span></span><br><span class="line">		<span class="attr">port</span>: <span class="string">6379    </span></span><br><span class="line">		<span class="attr">username</span>: <span class="string">root     </span></span><br><span class="line">		<span class="attr">password</span>: <span class="string">xxx</span></span><br></pre></td></tr></table></figure></li>
<li><p>测试。</p>
</li>
</ol>
<h2><span id="qi-springboot-shi-xian-ren-wu">七、springboot实现任务</span><a href="#qi-springboot-shi-xian-ren-wu" class="header-anchor">#</a></h2><ul>
<li>异步任务：执行的程序需要时间时，需要开启一个线程执行，并给客户一个提示。</li>
<li>定时任务：可以在某一个时间点执行一个任务。</li>
<li>邮件发送：</li>
</ul>
<h3><span id="1-yi-bu-ren-wu">1.异步任务</span><a href="#1-yi-bu-ren-wu" class="header-anchor">#</a></h3><ol>
<li><p>springboot开启异步任务。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableAsync</span> </span><br><span class="line"><span class="comment">// 开启异步任务</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Springboot05taskApplication</span> </span>&#123; </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;   </span><br><span class="line">        SpringApplication.run(Springboot05taskApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在需要开启线程的方法上加上</p>
<p>@Async</p>
<p>注解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncService</span> </span>&#123; </span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;     </span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);   </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;    </span><br><span class="line">            e.printStackTrace();   </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>执行时，可以先给用户反馈信息”OK”，任务仍在执行，不需要用户在加载页面等待。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span> </span><br><span class="line">    <span class="keyword">private</span> AsyncService asyncService; </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">Async</span><span class="params">()</span></span>&#123;     </span><br><span class="line">        asyncService.hello(); </span><br><span class="line">        <span class="comment">// 睡眠3秒   </span></span><br><span class="line">        System.out.println(<span class="string">&quot;正在处理数据&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;OK&quot;</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3><span id="2-you-jian-fa-song">2.邮件发送</span><a href="#2-you-jian-fa-song" class="header-anchor">#</a></h3><ol>
<li><p>导入mail依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mail发送--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>配置mail</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">//</span> <span class="string">application.yml</span></span><br><span class="line"><span class="attr">spring</span>:   <span class="string"></span></span><br><span class="line">	<span class="attr">mail</span>:    <span class="string"></span></span><br><span class="line">	<span class="attr">username</span>: <span class="string">xxx@qq.com   </span></span><br><span class="line">	<span class="attr">password</span>: <span class="string">xxx  </span></span><br><span class="line">	<span class="attr">host</span>: <span class="string">smtp.qq.com     </span></span><br><span class="line"><span class="comment"># QQ邮箱需要开启加密验证；其他的邮箱不需要。    </span></span><br><span class="line"><span class="attr">properties</span>: <span class="string">&#123;mail.smtp.ssl.enable: true&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p>编写邮件发送。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Springboot05taskApplicationTests</span> </span>&#123; </span><br><span class="line">    <span class="meta">@Autowired</span> </span><br><span class="line">    <span class="keyword">private</span> JavaMailSenderImpl mailSender;</span><br><span class="line">    <span class="meta">@Test</span> </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads01</span><span class="params">()</span> </span>&#123;   </span><br><span class="line">        SimpleMailMessage message = <span class="keyword">new</span> SimpleMailMessage();    </span><br><span class="line">        message.setSubject(<span class="string">&quot;你好啊！&quot;</span>);    </span><br><span class="line">        message.setText(<span class="string">&quot;这是一个问候邮件&quot;</span>);   </span><br><span class="line">        message.setFrom(<span class="string">&quot;xxx@qq.com&quot;</span>);   </span><br><span class="line">        message.setTo(<span class="string">&quot;xxx@qq.com&quot;</span>);  </span><br><span class="line">        mailSender.send(message); &#125; </span><br><span class="line">    <span class="meta">@Test</span> </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads02</span><span class="params">()</span> <span class="keyword">throws</span> MessagingException </span>&#123;    </span><br><span class="line">        <span class="comment">// 1.一个复杂的邮件。    </span></span><br><span class="line">        MimeMessage mimeMessage = mailSender.createMimeMessage(); </span><br><span class="line">        <span class="comment">// 2.组装。   </span></span><br><span class="line">        MimeMessageHelper helper = <span class="keyword">new</span> MimeMessageHelper(mimeMessage,<span class="keyword">true</span>);    </span><br><span class="line">        helper.setSubject(<span class="string">&quot;你好啊！&quot;</span>);    </span><br><span class="line">        helper.setText(<span class="string">&quot;&lt;h1 style=&#x27;color:red&#x27;&gt;这一个问候邮件！&lt;/h1&gt;&quot;</span>,<span class="keyword">true</span>);    </span><br><span class="line">        <span class="comment">// 附件    </span></span><br><span class="line">        helper.addAttachment(<span class="string">&quot;1.jpg&quot;</span>,<span class="keyword">new</span> File(<span class="string">&quot;C:\\Users\\SYWL\\Desktop\\2.jpg&quot;</span>)); </span><br><span class="line">        helper.setFrom(<span class="string">&quot;xxx@qq.com&quot;</span>);   </span><br><span class="line">        helper.setTo(<span class="string">&quot;xxx@qq.com&quot;</span>);     </span><br><span class="line">        mailSender.send(mimeMessage); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h2><span id="ba-dubbo-he-zookeeper">八、dubbo和Zookeeper</span><a href="#ba-dubbo-he-zookeeper" class="header-anchor">#</a></h2><h3><span id="1-fen-bu-shi-li-lun">1.分布式理论</span><a href="#1-fen-bu-shi-li-lun" class="header-anchor">#</a></h3><blockquote>
<p>在《分布式系统原理与范型》一书中有如下定义:“分布式系统是若干独立计算机的集合,这些计算机对于用户来说就像单个相关系统”。</p>
</blockquote>
<h4><span id="1-1-fen-bu-shi-xi-tong-gai-nian">1.1分布式系统概念</span><a href="#1-1-fen-bu-shi-xi-tong-gai-nian" class="header-anchor">#</a></h4><p>分布式系统是由一组通过网络进行通信、为了完成共同的任务而协调工作的计算机节点组成的系统。</p>
<h4><span id="1-1-fen-bu-shi-xi-tong-mu-de">1.1分布式系统目的</span><a href="#1-1-fen-bu-shi-xi-tong-mu-de" class="header-anchor">#</a></h4><p>为了用廉价的、普通的机器完成单个计算机无法完成的计算、存储任务。（其目的是利用更多的机器，处理更多的数据）</p>
<h4><span id="1-1-fa-zhan">1.1发展</span><a href="#1-1-fa-zhan" class="header-anchor">#</a></h4><ol>
<li>单一应用架构。<br>当网站流量很小时,只需—个应用,将所有功能都部署在一起,以减少部署节点和成本。此时,用于简化增删改查工作量的数据访问框架(ORM)是关键。<br>优点：适用于小型网站,小型管理系统,将所有功能都部署到一个功能里,简单易用。<br>缺点：1性能扩展比较难。2协同开发问题。3不利于升级维护。</li>
<li>垂直应用架构。<br>当访问量逐渐增大,单一应用增加机器帶来的加速度越来越小,将应用拆成互不相干的几个应用,以提升效率。此时,用于加速前端页面开发的Web框架(MVC)是关键。<br>优点：通过切分业务来实现各个模块独立部署,降低了维护和部署的难度,团队各司其职更易管理,性能扩展也更方便,更有针对性。<br>缺点：公用模块无法重复利用,开发性的浪费。</li>
<li>分布式服务架构。<br>当垂直应用越来越多,应用之间交互不可避免,将核心业务抽取出来,作为独立的服务,逐渐形成稳定的服务中心,使前端应用能更快速的响应多变的市场需求。此时,用于提高业务复用及整合的分布式服务框架（RPC）是关键。</li>
<li>流动计算架构。<br>当服务越来越多,容量的评估,小服务资源的浪费等问题逐渐显现,此时需增加一个调度中心基于访问压力实时管理集群容量,提高集群利用率。此时,用于提高机器利用率的资源调度和治理中心(SOA)[Service Oriented Architecture]是关键。</li>
</ol>
<h3><span id="2-shi-me-shi-rpc">2.什么是RPC</span><a href="#2-shi-me-shi-rpc" class="header-anchor">#</a></h3><p>RPC【Remote procedure cal】是指远程过程调用,是—种进程间通信方式,他是一种技术的思想,而不是规范。它允许程序调用另一个地址空间(通常是共亨网络的另一台机器上)的过程或函数而不用程序员显式编码这个远程调用的细节。（即程序员无论是调用本地的还是远程的函数,本质上编写的调用代码基本相同）<br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/04/25/kuangstudyca1763ca-a631-465f-a0b8-125e8bb5ecce.jpg" alt="img"><br>RPC两个核心模块：</p>
<ul>
<li>通讯</li>
<li>序列化（数据传输需要转换）</li>
</ul>
<h3><span id="3-shi-me-shi-dubbo">3.什么是dubbo</span><a href="#3-shi-me-shi-dubbo" class="header-anchor">#</a></h3><p>Apache dubbob是一款高性能、轻量级的开源Java rpc框架。<br>它提供了三大核心能力:</p>
<ul>
<li>面向接口的远程方法调用。</li>
<li>智能容错和负载均衡。</li>
<li>以及服务自动注册和发现。</li>
</ul>
<h3><span id="4-dubbo">4.dubbo</span><a href="#4-dubbo" class="header-anchor">#</a></h3><ul>
<li>服务提供者（provider）：暴露服务的服务提供方,服务提供者在启动时,向注册中心注册自己提供的服务。</li>
<li>服务消费者（Consomer）：调用远程服务的服务消费方,服务消费者在启动时,向注册中心订阅自己所需的服务,服务消费者,从提供者地址列表中,基于软负载均衡算法,选一台提供者进行调用,如果调用失败,再选另一台调用。</li>
<li>注册中心（Registy）：注册中心返回服务提供者地址列表给消费者,如果有变更,注册中心将基于长连接推送变更数据给消费者。</li>
<li>监控中心：服务消费者和提供者,在内存中累计调用次数和调用时间,定时每分钟发送一次统计数据到监控中心。</li>
</ul>
<h3><span id="5-zookeeper">5.zookeeper</span><a href="#5-zookeeper" class="header-anchor">#</a></h3><p>zookeeper是注册中心</p>
<ol>
<li>下载zookeeper<br><a target="_blank" rel="noopener" href="https://downloads.apache.org/zookeeper/">https://downloads.apache.org/zookeeper/</a></li>
<li>修改配置文件名称<br>修改apache-zookeeper-3.6.3-bin/conf/zoo_sample.cfg名称为zoo.cfg</li>
<li>启动zookeeper<br>windows下密令：双击apache-zookeeper-3.6.3-bin/bin/zkServer.cmd</li>
<li>可以启动客户端连接<br>windows下密令：双击apache-zookeeper-3.6.3-bin/bin/zkCli.cmd</li>
</ol>
<h3><span id="6-dubbo-admin">6.dubbo-admin</span><a href="#6-dubbo-admin" class="header-anchor">#</a></h3><p>dubbo-admin是一个监控管理后台，查看我们注册了哪些服务，哪些服务被消费了</p>
<ol>
<li>下载dubbo-admin<br><a target="_blank" rel="noopener" href="https://github.com/apache/dubbo-admin/tree/master">https://github.com/apache/dubbo-admin/tree/master</a></li>
<li>进入到项目中打包</li>
</ol>
<ul>
<li>dubbo-admin-master目录下打开cmd</li>
<li>执行打包密令mvn clean package -D maven.test.skip=true</li>
<li>启动dubbo-admin项目</li>
<li>启动jar包密令：java -jar xxx.jar</li>
<li>访问localhost:7001 (默认端口7001)</li>
</ul>
<h3><span id="7-springboot-zheng-he-dubbo-zookeeper">7.springboot整合dubbo+zookeeper</span><a href="#7-springboot-zheng-he-dubbo-zookeeper" class="header-anchor">#</a></h3><ol>
<li><p>启动zookeeper注册中心<br>默认端口号是2181</p>
</li>
<li><p>提供者提供服务。</p>
<ol>
<li><p>导入依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--dubbo--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>     </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--zkclient--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.sgroschupf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--引入zookeeper，会有日志冲突，需要排除包--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>     </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-recipes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span>   </span><br><span class="line">    <span class="comment">&lt;!--排除slf4j-log4j12--&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span>       </span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span>    </span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>配置注册中心地址，提供者提供的服务名，需要扫描的包。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">//</span> <span class="string">application.yml</span></span><br><span class="line"><span class="attr">server</span>:   <span class="string">port: 8081</span></span><br><span class="line"><span class="attr">dubbo</span>:  <span class="string"></span></span><br><span class="line"><span class="attr">application</span>:    <span class="string"></span></span><br><span class="line"><span class="attr">name</span>: <span class="string">provider-server</span></span><br><span class="line"><span class="comment"># 注册的服务应用名称   </span></span><br><span class="line"><span class="attr">registry</span>:     <span class="string"></span></span><br><span class="line"><span class="attr">address</span>: <span class="string">zookeeper://localhost:2181 </span></span><br><span class="line"><span class="comment"># 注册中心地址   </span></span><br><span class="line"><span class="attr">scan</span>:     <span class="string"></span></span><br><span class="line"><span class="meta">base-packages</span>: <span class="string">com.sywl.service</span></span><br><span class="line"><span class="comment"># 哪些服务要被注册</span></span><br></pre></td></tr></table></figure></li>
<li><p>在想被注册的服务上面增加一个dubbo的</p>
<p>@Service</p>
<p>注解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.dubbo.config.annotation.Service;</span><br><span class="line"><span class="comment">// zookeeper：服务注册与发现</span></span><br><span class="line"><span class="meta">@Service</span> </span><br><span class="line"><span class="comment">//dubbo的@sevice注解：可以被扫描到，在项目一启动就自动注册到注册中心</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TickerServiceImpl</span> <span class="keyword">implements</span> <span class="title">TicketService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTicket</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;你好啊&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>消费者如何消费</p>
<ol>
<li><p>导入依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">&lt;!--dubbo--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line">   <span class="comment">&lt;!--zkclient--&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>     </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.sgroschupf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--引入zookeeper，会有日志冲突，需要排除包--&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>   </span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-recipes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>   </span><br><span class="line">       <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>   </span><br><span class="line">       <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span>   </span><br><span class="line">       <span class="comment">&lt;!--排除slf4j-log4j12--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span>         </span><br><span class="line">           <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span>       </span><br><span class="line">               </span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>      </span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>    </span><br><span class="line">           <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span>   </span><br><span class="line">       <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>配置注册中心地址，消费者自己的的服务名。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">//</span> <span class="string">application.yml</span></span><br><span class="line"><span class="attr">server</span>:   <span class="string"></span></span><br><span class="line"><span class="attr">port</span>: <span class="string">8082</span></span><br><span class="line"><span class="attr">dubbo</span>:   <span class="string"></span></span><br><span class="line"><span class="attr">application</span>:       <span class="string"></span></span><br><span class="line"><span class="attr">name</span>: <span class="string">consumer-server </span></span><br><span class="line"><span class="comment"># 消费者去拿服务需要暴露自己的名字   </span></span><br><span class="line"><span class="attr">registry</span>:         <span class="string"></span></span><br><span class="line"><span class="attr">address</span>: <span class="string">zookeeper://localhost:2181 </span></span><br><span class="line"><span class="comment"># 注册中心地址</span></span><br></pre></td></tr></table></figure></li>
<li><p>从远程注入服务</p>
<p>@Reference</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="meta">@Service</span> </span><br><span class="line"><span class="comment">// 注入容器</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 去注册中心拿provider-server提供的票</span></span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    <span class="comment">//引用（远程调用），需要定义服务提供者路径相同的接口名</span></span><br><span class="line">    TicketService tiketService;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buyTiket</span><span class="params">()</span></span>&#123; </span><br><span class="line">        String ticket = tiketService.getTicket(); </span><br><span class="line">        System.out.println(<span class="string">&quot;在注册中心拿到服务：&quot;</span>+ ticket);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
	
		</div>
		
		<div id="current-post-cover" data-scr="/img%5Ccart_cover1.jpg"></div>

		<!-- relate post, comment...-->
		<div class="investment-container">
			<div class="investment-header">
				<div class="investment-title-1">
					<div class="on">相关文章</div>
					<div>评论</div>
					<div>分享</div>
				</div>
				<div class="investment-title-2">	            
					
	<span>
		<a id="totop-post-page">返回顶部</a>
		
		
			<a href="/2021/06/24/Mybatis%E7%9F%A5%E8%AF%86%E7%82%B9/" title="Mybatis知识点" rel="next">
				下一篇&raquo;
			</a>
			
	</span>


      		
				</div>	
			</div>
			
			<div class="investment-content">
				<div class="investment-content-list">
					

<div class="relate-post">
	
		<ul>
			
					<li>
						<div class="relate-post-text">
							<a class="relate-post-title" href="/2021/06/24/SpringMVC%E7%9F%A5%E8%AF%86%E7%82%B9/" title="SpringMVC知识点">
								SpringMVC知识点			
							</a>
							<p class="relate-post-date">
								<i class="fa fa-calendar"></i>
								六月 24日, 2021				
							</p>
							<p class="relate-post-content">
								




按配置文件分类
pom.xml
web.xml
springmvc.xml
头部
地基
加强




不常用注解
@RequestParam
@RequestBody
@PathVariable
@RequestHeader...
							</p>
						</div>

						<div class="relate-post-cover">
							<a href="/2021/06/24/SpringMVC%E7%9F%A5%E8%AF%86%E7%82%B9/" title="SpringMVC知识点">				
								
								<img class="lazy" src="/img/lazy.gif" data-src="img\cart_cover1.jpg" alt="SpringMVC知识点"/>
							</a>
						</div>
					</li>												
			
					<li>
						<div class="relate-post-text">
							<a class="relate-post-title" href="/2021/06/24/SSM%E6%95%B4%E5%90%88/" title="SSM整合">
								SSM整合			
							</a>
							<p class="relate-post-date">
								<i class="fa fa-calendar"></i>
								六月 24日, 2021				
							</p>
							<p class="relate-post-content">
								




SSM
1 Spring环境搭建
1.1 创建好项目后导入Spring和Junit包
1.2 Spring核心配置文件applicationContext.xml


2 Mybatis环境搭建
2.1 数据库搭建
2.2 ...
							</p>
						</div>

						<div class="relate-post-cover">
							<a href="/2021/06/24/SSM%E6%95%B4%E5%90%88/" title="SSM整合">				
								
								<img class="lazy" src="/img/lazy.gif" data-src="img\cart_cover1.jpg" alt="SSM整合"/>
							</a>
						</div>
					</li>												
			
					<li>
						<div class="relate-post-text">
							<a class="relate-post-title" href="/2021/06/02/Spring%E7%9F%A5%E8%AF%86%E7%82%B9/" title="Spring知识点">
								Spring知识点			
							</a>
							<p class="relate-post-date">
								<i class="fa fa-calendar"></i>
								六月 2日, 2021				
							</p>
							<p class="relate-post-content">
								




前言
一、spring
1.spring目的
2.spring是什么
3.spring组成
4.spring配置


二、IOC
1.IOC的本质
2.IOC创建对象的方式


三、DI
1.依赖注入的几种方式
2.bean...
							</p>
						</div>

						<div class="relate-post-cover">
							<a href="/2021/06/02/Spring%E7%9F%A5%E8%AF%86%E7%82%B9/" title="Spring知识点">				
								
								<img class="lazy" src="/img/lazy.gif" data-src="img\cart_cover1.jpg" alt="Spring知识点"/>
							</a>
						</div>
					</li>												
			
					<li>
						<div class="relate-post-text">
							<a class="relate-post-title" href="/2021/04/29/Vue%E7%9F%A5%E8%AF%86%E7%82%B9/" title="Vue知识点">
								Vue知识点			
							</a>
							<p class="relate-post-date">
								<i class="fa fa-calendar"></i>
								四月 29日, 2021				
							</p>
							<p class="relate-post-content">
								











什么是Vue#
什么是: 基于MVVM设计模式的渐进式的纯前端js框架(1). MVVM?(2). 渐进式: 不要求整个项目都用vue做，可以轻松和别的技术混搭，且会多少就可以先用多少！(3). 纯前端js框架...
							</p>
						</div>

						<div class="relate-post-cover">
							<a href="/2021/04/29/Vue%E7%9F%A5%E8%AF%86%E7%82%B9/" title="Vue知识点">				
								
								<img class="lazy" src="/img/lazy.gif" data-src="img\cart_cover1.jpg" alt="Vue知识点"/>
							</a>
						</div>
					</li>												
			
					<li>
						<div class="relate-post-text">
							<a class="relate-post-title" href="/2021/04/23/hello-world/" title="Hello World">
								Hello World			
							</a>
							<p class="relate-post-date">
								<i class="fa fa-calendar"></i>
								四月 23日, 2021				
							</p>
							<p class="relate-post-content">
								你好呀！欢迎

							</p>
						</div>

						<div class="relate-post-cover">
							<a href="/2021/04/23/hello-world/" title="Hello World">				
								
								<img class="lazy" src="/img/lazy.gif" data-src="/img/cart_cover1.jpg" alt="Hello World"/>
							</a>
						</div>
					</li>												
			
		</ul>
	
</div>	
				</div>
				<div class="investment-content-list">
					<div class="layout-comment">

	
		<div class="config-info">
			Please check the parameter of <b>comment</b> in config.yml of hexo-theme-Annie!
		</div>	
	

</div>
				</div>
				<div class="investment-content-list">
					<div class="layout-share">
	
	

		
			
			<!-- socialShare share -->
			<div class="social-share"></div>

<!--  css & js -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
<script async src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
			
		
		
	
</div>


				</div>
			</div>	
		</div>
	</div>
</div>

<!-- show math formula -->



	 
	
<script src="/plugin/clipboard/clipboard.js"></script>

	<script>
		// Copy code !
	    function preprocessing() {
	        $("#article-content .highlight").each(function() {
	            $(this).wrap('<div id="post-code"></div>');
	        })

	        $("#article-content #post-code").each(function() {
	            $(this).prepend('<nav class="copy-nav"><span><i class="code-language"></i></span></nav>');
	        })

	        $("#article-content .copy-nav").each(function() {
	            let languageClass = $(this).next().attr('class'),
	                language = ((languageClass.length > 9) && (languageClass != null)) ? languageClass.substr(10) : "none"; //why 9? Need to check language?

	            $(this).find('.code-language').text(language);
	            $(this).append('<span class="copy-btn icon-paste"></span>');
	        });
	    }

		function copy() {
		    $('#article-content #post-code').each(function(i) {
		        let codeCopyId = 'codeCopy-' + i;

		        let codeNode = $(this).find('.code'),
		            copyButton = $(this).find('.copy-btn');

		        codeNode.attr('id', codeCopyId);
		        copyButton.attr('data-clipboard-target-id', codeCopyId);
		    })
   
			let clipboard = new ClipboardJS('.copy-btn', {
					target: function(trigger) {
						return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
					}
		      	});

			//pure js
			function showTooltip(elem, msg) {		   
				elem.setAttribute('aria-label', msg);
				elem.setAttribute('class', 'copy-btn icon-clipboard1');
				setTimeout(function() {
					elem.setAttribute('class', 'copy-btn icon-paste');
				}, 2000);
			}

			clipboard.on('success', function(e) {
			    e.clearSelection();
			    console.info('Action:', e.action);		   
			    console.info('Trigger:', e.trigger);
			    showTooltip(e.trigger, 'Copied!');   
			});
			
			clipboard.on('error', function(e) {
			    console.error('Action:', e.action);
			    console.error('Trigger:', e.trigger);
			});
		}
		
		(function copyCode(){
			if ($('.layout-post').length) {
			    preprocessing();
			    copy();
			} 
		})();
	</script>






<link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">


<script src="/plugin/fancybox/jquery.fancybox.js"></script>


<script type="text/javascript">
	(function gallerySet(){
		let titleID = $('.article-title a'),
			imageID = $('.article-content img'),
			videoID = $('.article-content video');
		
		let postTitle = titleID.text() ? titleID.text() : "No post title!";
		
		imageID.each(function() {
			let imgPath = $(this).attr('src'),
				imgTitle = $(this).attr('alt') ? $(this).attr('alt') : "No image description!";
		
			//给每个匹配的<img>元素打包, 即添加父元素<a>
			$(this).wrap('<a data-fancybox="gallery" data-caption="《 ' + postTitle + ' 》' + imgTitle + '"href="' + imgPath + '"> </a>');
		});
		
		videoID.each(function() {
			let videoPath = $(this).attr('src');
		
			//给每个匹配的<img>元素打包, 即添加父元素<a>
			$(this).wrap('<a data-fancybox href=" ' + videoPath + ' "> </a>');
		});
		
		//TODO：支持html5 video

		if($('#layout-post').length) {
			$('[data-fancybox="gallery"]').fancybox({
				loop: true,
				buttons: [
					"zoom",
					"share",
					"slideShow",
					"fullScreen",
					//"download",
					"thumbs",
					"close"
				],
				protect: true
			});
		}
	})();
</script>
		</main>

		<!--footer-->
		<footer>
	<div id="navigation-show">
		<ul id="global-nav">
	
		<li class="menu-home">
			<a href="https://Whiteboy-DY.github.io" class="menu-item-home" target="_blank">主页</a>
		</li>
		
	
		<li class="menu-archive">
			<a href="/archives" class="menu-item-archive" target="_blank">归档</a>
		</li>
		
	
		<li class="menu-categories">
			<a href="/categories" class="menu-item-categories" target="_blank">分类</a>
		</li>
		
	
		<li class="menu-tags">
			<a href="/tags" class="menu-item-tags" target="_blank">标签</a>
		</li>
		
	
		<li class="menu-about">
			<a href="/about" class="menu-item-about" target="_blank">关于</a>
		</li>
		
	

	
		<li class="menu-search">
			<a href="javascript:;" class="popup-trigger">搜索</a>
		</li>
	
</ul>
	</div>

	<div class="copyright">
		<p>
			 
				&copy;2021, content by Sariay. All Rights Reserved.
			
			
				<a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> Theme <a href="https://github.com/Sariay/hexo-theme-Annie" title="Annie" target="_blank" rel="noopener">Annie</a> by Sariay.
			
		</p>
		<p>
			

	<!-- busuanzi -->
	<!-- busuanzi -->



			<a href="javascript:zh_tran('s');" class="zh_click" id="zh_click_s">简体</a> 
			<a href="javascript:zh_tran('t');" class="zh_click" id="zh_click_t">繁體</a>				
		</p>
	</div>		
</footer>
		
	<!-- Local or hitokoto! -->

	
<script src="/plugin/motto/motto.js"></script>

	
	<script type="text/javascript">
		(function motto(){
			let mottoText = getMingYanContent().split('</br> - </br>'),
			
			mottoTextContent = mottoText[0]?mottoText[0]:'请刷新...',
			
			mottoTextFrom = mottoText[1]?mottoText[1]:'one/一个';
			
			mottoTextContent = mottoTextContent.trim().substring(0, 100);
		
			$("#motto-content").html( mottoTextContent);
			$("#motto-author").html( mottoTextFrom  );
		})();	
	</script>	



<!-- love effect -->

	
<script src="/plugin/love/love.js"></script>



<!-- back to top -->

	<div id="totop">
	<span class="icon-circle-up"></span>
</div>



<!-- site analysis -->


	<!-- site-analysis -->
	
	
	
	
	
 

<!-- leancloud -->


	<!-- leancloud -->
	<!--
	时间：2018-11-27
	描述：
		文章访问量：visitors
		文章喜欢量：likes	
		文章排行榜：topNPost
		其他得说明：
			01-Cookie相关的函数 
				https://blog.csdn.net/somehow1002/article/details/78511541（Author：somehow1002）
			02-visitors相关的函数 
				https://blog.csdn.net/u013553529/article/details/63357382（Author：爱博客大伯）
				https://notes.doublemine.me/2015-10-21-为NexT主题添加文章阅读量统计功能.html（Author：夏末）
			03-topNPost相关的函数
				https://hoxis.github.io/hexo-next-read-rank.html（Author：hoxis）
			04-likes相关的函数，
				参考了01 & 02进行简单的设计与实现
-->


	

  

	<!--
	时间：2018-10-3
	描述：
		插件名称：hexo-generator-search-zip
		插件来源: https://github.com/SuperKieran/hexo-generator-search-zip
		代码参考：https://github.com/SuperKieran/TKL/blob/master/layout/_partial/search.ejs(Include: js & css)	
-->
<div class="popup search-popup local-search-popup scrollbar" >
	<div class="local-search-container">
		<span class="popup-btn-close">
      		ESC
   		</span>
		<div class="local-search-header">
			<div class="input-prompt">				
			</div>
			<input autocomplete="off" placeholder="Search..." type="text" id="local-search-input">
		</div>
		<div class="local-search-body">
			<div id="local-search-output"></div>
		</div>
		<div class="local-search-footer">
			<div class="topN-post">				
				
								
			</div>
		</div>
	</div>
</div>


<script src="/plugin/search/ziploader.js"></script>
<script src="/js/search.js"></script>


<script type="text/javascript">
	var search_path = 'search.json',
		zip_Path = '/search.zip',
		version_Path = '/searchVersion.txt',
		input_Trigger = 'auto',
		top_N = '2';

	themeLocalSearch({
		search_path, 
		zip_Path, 
		version_Path, 
		input_Trigger, 
		top_N
	});
</script>



<script src="/plugin/chinese/chinese.js"></script>
<script src="/plugin/imagelazyloader/yall.min.js"></script>
<script src="/plugin/imageloaded/imagesloaded.pkgd.min.js"></script>
<script src="/plugin/nicescroll/jquery.nicescroll.js"></script>
<script src="/plugin/resizediv/resizediv.js"></script>
<script src="/js/main.js"></script>

	</body>	
</html>